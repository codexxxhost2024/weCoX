<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>WeConnect - Dashboard & Tools</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <link rel="icon" href="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAxMDAgMTAwIj48cGF0aCBkPSJNNTAsNCBDMjQuNSw0IDQsMjQuNSA0LDUwYzAsMjUuNSAyMC41LDQ2IDQ2LDQ2czQ2LTIwLjUgNDYtNDZDMzYuNSwyNC41IDc1LjUsNCA1MCw0ek0yNSwzNSBDMzAuNSwzNSAzNSwzMC41IDM1LDI1YzAtNS41LTQuNS0xMC0xMC0xMFMyNSwxOS41IDI1LDI1QzI1LDMwLjUgMjkuNSwzNSAzMCwzNXpNMTUsNzAgQzE1LDY0LjUgMTkuNSw2MCAyNSw2MGMyLjUsMCA1LDAuOCA3LDIuMkw0MCw1MGwtNy44LTEyQzI5LjcsMzggMjcuNSwzOCAyNSwzOHMtNSwyLjUtNSw1Vjcwek03NSw2NSBDNjkuNSw2NSA2NSw2OS41IDY1LDc1YzAsNS41IDQuNSwxMCAxMCwxMFM4NSw4MC41IDg1LDc1Qzg1LDY5LjUgODAuNSw2NSA3NSw2NXpNODUsMzAgQzg1LDM1LjUgODAuNSw0MCA3NSw0MGMtMi41LDAtNS0wLjgtNy0yLjJMNjAsNTBsNy44LDEyQzcwLjMsNjIgNzIuNSw2MiA3NSw2MnM1LTIuNSA1LTVWMzB6IiBmaWxsPSIjMWYzYTVjIi8+PC9zdmc+" type="image/svg+xml"> <!-- Placeholder favicon -->
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@24,400,0,0">
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
  <style>
    :root {
      /* Light Mode (Default) */
      --primary-color-light: #1F3A5C; --primary-variant-color-light: #2c5282; --accent-color-light: #4A90E2;
      --background-color-light: #f0f2f5; --surface-color-light: #ffffff; --on-primary-color-light: #ffffff;
      --text-color-light: #333; --text-muted-color-light: #555; --border-color-light: #e2e8f0;
      --gradient-primary-light: linear-gradient(135deg, var(--accent-color-light) 0%, var(--primary-color-light) 100%);
      --trending-bg-light: #FFFBEB; --trending-text-light: #926319; --card-shadow-light: 0 1px 3px rgba(0, 0, 0, 0.08);
      --wallet-card-bg-light: linear-gradient(160deg, #2c3e50 0%, #1d2b3a 100%);
      --wallet-card-text-primary-light: #FFFFFF; --wallet-card-text-secondary-light: #BDC3C7;
      --wallet-card-chip-bg-light: linear-gradient(to bottom right, #d1b075, #a88854, #d1b075);
      --wallet-action-button-bg-light: rgba(255, 255, 255, 0.1); --wallet-action-button-border-light: rgba(255, 255, 255, 0.15);
      --wallet-action-button-hover-bg-light: rgba(255, 255, 255, 0.18); --wallet-action-button-hover-border-light: rgba(255, 255, 255, 0.3);

      /* Dark Mode */
      --primary-color-dark: #00ffff; --primary-variant-color-dark: #00cccc; --accent-color-dark: #ff5252;
      --background-color-dark: #0d1117; --surface-color-dark: #171b26; --on-primary-color-dark: #0d1117;
      --text-color-dark: #c9d1d9; --text-muted-color-dark: #8b949e; --border-color-dark: rgba(0, 255, 255, 0.15);
      --gradient-primary-dark: linear-gradient(135deg, var(--primary-variant-color-dark) 0%, var(--primary-color-dark) 100%);
      --sidebar-active-bg-dark: var(--primary-color-dark); --sidebar-text-on-active-dark: var(--on-primary-color-dark);
      --trending-bg-dark: var(--accent-color-dark); --trending-text-dark: #ffffff; --card-shadow-dark: 0 0 15px rgba(0, 255, 255, 0.07);
      --wallet-card-bg-dark: var(--surface-color-dark); --wallet-card-text-primary-dark: var(--text-color-dark);
      --wallet-card-text-secondary-dark: var(--text-muted-color-dark);
      --wallet-card-chip-bg-dark: linear-gradient(to bottom right, #4a5568, #2d3748, #4a5568);
      --wallet-action-button-bg-dark: rgba(0, 255, 255, 0.1); --wallet-action-button-border-dark: rgba(0, 255, 255, 0.2);
      --wallet-action-button-hover-bg-dark: rgba(0, 255, 255, 0.18); --wallet-action-button-hover-border-dark: rgba(0, 255, 255, 0.35);

      /* Shared */
      --font-family: 'Inter', sans-serif; --font-display: 'Inter', sans-serif; --font-body: 'Inter', sans-serif;
      --transition-speed: 0.25s; --sidebar-width: 240px; --sidebar-width-collapsed: 60px; --topbar-height: 56px;
      --card-border-radius: 6px; --card-padding: 0.9rem;
      --font-size-base: 0.78rem; --font-size-small: 0.65rem; --font-size-medium: 0.72rem; --font-size-large: 0.85rem;
      --font-size-xl: 1.1rem; --font-size-card-description: 0.7rem;
    }
    :root { /* Initialize with Light Mode */
        --primary-color: var(--primary-color-light); --primary-variant-color: var(--primary-variant-color-light);
        --accent-color: var(--accent-color-light); --background-color: var(--background-color-light);
        --surface-color: var(--surface-color-light); --on-primary-color: var(--on-primary-color-light);
        --text-color: var(--text-color-light); --text-muted-color: var(--text-muted-color-light);
        --border-color: var(--border-color-light); --gradient-primary: var(--gradient-primary-light);
        --sidebar-active-bg: var(--primary-color-light); --sidebar-text-on-active: var(--on-primary-color-light);
        --trending-bg: var(--trending-bg-light); --trending-text: var(--trending-text-light); --card-shadow: var(--card-shadow-light);
        --wallet-card-bg: var(--wallet-card-bg-light); --wallet-card-text-primary: var(--wallet-card-text-primary-light);
        --wallet-card-text-secondary: var(--wallet-card-text-secondary-light); --wallet-card-chip-bg: var(--wallet-card-chip-bg-light);
        --wallet-action-button-bg: var(--wallet-action-button-bg-light); --wallet-action-button-border: var(--wallet-action-button-border-light);
        --wallet-action-button-hover-bg: var(--wallet-action-button-hover-bg-light); --wallet-action-button-hover-border: var(--wallet-action-button-hover-border-light);
    }
    [data-theme="dark"] {
        --primary-color: var(--primary-color-dark); --primary-variant-color: var(--primary-variant-color-dark);
        --accent-color: var(--accent-color-dark); --background-color: var(--background-color-dark);
        --surface-color: var(--surface-color-dark); --on-primary-color: var(--on-primary-color-dark);
        --text-color: var(--text-color-dark); --text-muted-color: var(--text-muted-color-dark);
        --border-color: var(--border-color-dark); --gradient-primary: var(--gradient-primary-dark);
        --sidebar-active-bg: var(--sidebar-active-bg-dark); --sidebar-text-on-active: var(--sidebar-text-on-active-dark);
        --trending-bg: var(--trending-bg-dark); --trending-text: var(--trending-text-dark); --card-shadow: var(--card-shadow-dark);
        --wallet-card-bg: var(--wallet-card-bg-dark); --wallet-card-text-primary: var(--wallet-card-text-primary-dark);
        --wallet-card-text-secondary: var(--wallet-card-text-secondary-dark); --wallet-card-chip-bg: var(--wallet-card-chip-bg-dark);
        --wallet-action-button-bg: var(--wallet-action-button-bg-dark); --wallet-action-button-border: var(--wallet-action-button-border-dark);
        --wallet-action-button-hover-bg: var(--wallet-action-button-hover-bg-dark); --wallet-action-button-hover-border: var(--wallet-action-button-hover-border-dark);
    }
    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; -webkit-tap-highlight-color: transparent; }
    body { font-family: var(--font-family); background-color: var(--background-color); color: var(--text-color); line-height: 1.5; font-size: var(--font-size-base); transition: background-color var(--transition-speed) ease, color var(--transition-speed) ease; overflow-x: hidden; }
    a { text-decoration: none; color: var(--primary-color); transition: color var(--transition-speed) ease; }
    a:hover { text-decoration: underline; color: var(--primary-variant-color); }
    ul { list-style: none; } img { max-width: 100%; height: auto; display: block; }
    button { font-family: inherit; cursor: pointer; border: none; border-radius: 5px; transition: background-color var(--transition-speed), transform 0.1s, box-shadow var(--transition-speed); }
    button:active { transform: translateY(1px) scale(0.98); }
    .material-symbols-outlined { font-variation-settings: 'FILL' 0, 'wght' 400, 'GRAD' 0, 'opsz' 24; vertical-align: middle; }
    .app-container { display: flex; min-height: 100vh; }
    .sidebar { width: var(--sidebar-width); background-color: var(--surface-color); border-right: 1px solid var(--border-color); position: fixed; top: 0; left: 0; height: 100%; padding: 0.7rem 0; overflow-y: auto; overflow-x: hidden; transition: width var(--transition-speed) ease, transform var(--transition-speed) ease, background-color var(--transition-speed) ease, border-color var(--transition-speed) ease; z-index: 1000; }
    .sidebar::-webkit-scrollbar { width: 4px; } .sidebar::-webkit-scrollbar-thumb { background-color: var(--border-color); border-radius: 2px; }
    .sidebar-header { display: flex; align-items: center; padding: 0 0.8rem; border-bottom: 1px solid var(--border-color); margin-bottom: 0.7rem; min-height: var(--topbar-height); }
    .sidebar-header .logo { height: 26px; width: auto; margin-right: 0.5rem; object-fit: contain; }
    .sidebar-header .app-title-sidebar { font-family: var(--font-display); font-size: 1rem; font-weight: 600; color: var(--text-color); white-space: nowrap; opacity: 1; transition: opacity var(--transition-speed) ease 0.1s, color var(--transition-speed) ease; }
    [data-theme="dark"] .sidebar-header .app-title-sidebar { color: var(--primary-color); }
    .sidebar-nav ul { padding: 0 0.6rem; }
    .sidebar-nav .nav-heading { font-family: var(--font-display); font-size: var(--font-size-small); text-transform: uppercase; letter-spacing: 0.5px; color: var(--text-muted-color); padding: 0.7rem 0.3rem 0.3rem; font-weight: 500; white-space: nowrap; opacity: 1; }
    .sidebar-nav li a { display: flex; align-items: center; padding: 0.5rem 0.4rem; color: var(--text-color); border-radius: 4px; margin-bottom: 0.15rem; font-family: var(--font-body); font-size: var(--font-size-medium); font-weight: 500; }
    .sidebar-nav li a i.fas, .sidebar-nav li a i.far, .sidebar-nav li a .material-symbols-outlined { font-size: 0.85rem; min-width: 16px; margin-right: 0.6rem; text-align: center; }
    .sidebar-nav li a:hover { background-color: rgba(0,0,0,0.04); color: var(--primary-color); }
    [data-theme="dark"] .sidebar-nav li a:hover { background-color: rgba(255,255,255,0.05); }
    .sidebar-nav li a.active { background: var(--sidebar-active-bg); color: var(--sidebar-text-on-active); }
    .sidebar-nav li a.active i.fas, .sidebar-nav li a.active i.far, .sidebar-nav li a.active .material-symbols-outlined { color: var(--sidebar-text-on-active); }
    .sidebar.collapsed { width: var(--sidebar-width-collapsed); }
    .sidebar.collapsed .sidebar-header { padding-left: 0; padding-right: 0; justify-content: center;}
    .sidebar.collapsed .sidebar-header .app-title-sidebar { opacity: 0; pointer-events: none; width: 0; }
    .sidebar.collapsed .sidebar-header .logo { margin-right: 0; height: 24px; }
    .sidebar.collapsed .sidebar-nav .nav-heading { opacity: 0; pointer-events: none; height: 0; padding: 0; margin: 0; }
    .sidebar.collapsed .sidebar-nav li a span { opacity: 0; pointer-events: none; width: 0; }
    .sidebar.collapsed .sidebar-nav li a { justify-content: center; padding: 0.5rem 0; }
    .sidebar.collapsed .sidebar-nav li a i.fas, .sidebar.collapsed .sidebar-nav li a i.far, .sidebar.collapsed .sidebar-nav li a .material-symbols-outlined { margin-right: 0; font-size: 0.95rem; }
    .main-wrapper { flex-grow: 1; margin-left: var(--sidebar-width); display: flex; flex-direction: column; transition: margin-left var(--transition-speed) ease; }
    .sidebar.collapsed + .main-wrapper { margin-left: var(--sidebar-width-collapsed); }
    .topbar { height: var(--topbar-height); background-color: var(--surface-color); border-bottom: 1px solid var(--border-color); display: flex; align-items: center; justify-content: space-between; padding: 0 1rem; position: sticky; top: 0; z-index: 900; box-shadow: 0 1px 2px rgba(0,0,0,0.05); }
    [data-theme="dark"] .topbar { box-shadow: 0 1px 2px rgba(0, 255, 255, 0.05); }
    .hamburger-btn { background: none; border: none; color: var(--text-color); font-size: 1.2rem; cursor: pointer; margin-right: 0.6rem; display: flex; align-items: center; justify-content: center; width: 32px; height: 32px; border-radius: 50%; }
    .hamburger-btn:hover { background-color: rgba(0,0,0,0.05); }
    [data-theme="dark"] .hamburger-btn { color: var(--primary-color); }
    [data-theme="dark"] .hamburger-btn:hover { background-color: rgba(0, 255, 255, 0.08); }
    .app-title-topbar { font-family: var(--font-display); font-size: var(--font-size-xl); font-weight: 600; color: var(--primary-color); }
    [data-theme="dark"] .app-title-topbar { color: var(--primary-color); }
    .topbar-right { display: flex; align-items: center; gap: 0.6rem; }
    .btn { padding: 0.4rem 0.8rem; border-radius: 5px; font-weight: 600; font-family: var(--font-display); font-size: 0.7rem; }
    .btn-upgrade { background: var(--primary-color); color: var(--on-primary-color); }
    .btn-upgrade:hover { opacity: 0.9; background-color: var(--primary-variant-color); }
    [data-theme="dark"] .btn-upgrade { background: var(--primary-color); color: var(--on-primary-color-dark); }
    [data-theme="dark"] .btn-upgrade:hover { background: var(--primary-variant-color); }
    .btn-upgrade i.fas { margin-right: 0.3rem; font-size: 0.9em; }
    .theme-toggle-btn { background: none; border: 1px solid var(--border-color); color: var(--text-muted-color); font-size: 0.9rem; width: 32px; height: 32px; border-radius: 50%; display: flex; align-items: center; justify-content: center; }
    .theme-toggle-btn:hover { background-color: rgba(0,0,0,0.03); }
    [data-theme="dark"] .theme-toggle-btn { border-color: var(--primary-color); color: var(--primary-color); }
    [data-theme="dark"] .theme-toggle-btn:hover { background-color: rgba(0, 255, 255, 0.08); }
    .profile-menu .profile-icon { width: 32px; height: 32px; border-radius: 50%; cursor: pointer; border: 1px solid var(--border-color); }
    [data-theme="dark"] .profile-menu .profile-icon { border-color: var(--primary-color); }
    .content-area { flex-grow: 1; padding: 1rem; overflow-y: auto; }
    .content-header { margin-bottom: 1rem; }
    .content-header h2 { font-family: var(--font-display); font-size: var(--font-size-large); font-weight: 600; margin-bottom: 0.2rem; color: var(--text-color); }
    .content-header p { font-size: var(--font-size-base); color: var(--text-muted-color); font-family: var(--font-body); }
    .wallet-info-card { background: var(--wallet-card-bg); color: var(--wallet-card-text-primary); border-radius: var(--card-border-radius); padding: var(--card-padding); box-shadow: var(--card-shadow); position: relative; overflow: hidden; margin-bottom: 1rem; }
    .wallet-info-card-header { display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: var(--card-padding); }
    .wallet-info-card .user-info .user-name { color: var(--wallet-card-text-primary); font-weight: 600; font-size: 0.9rem; margin-bottom: 2px; }
    .wallet-info-card .user-info .user-id { color: var(--wallet-card-text-secondary); font-size: 0.65rem; opacity: 0.8; }
    .wallet-info-card .card-chip { width: 36px; height: 26px; background-image: var(--wallet-card-chip-bg); border-radius: 4px; box-shadow: inset 0px 0.5px 1px rgba(0,0,0,0.3), 0px 0.5px 0.5px rgba(255,255,255,0.1); margin-top: 2px; }
    .wallet-info-card .balance-details { display: flex; justify-content: space-around; align-items: flex-start; margin-bottom: var(--card-padding); gap: 0.5rem; }
    .wallet-info-card .balance-source { flex: 1; padding: 0 0.25rem; text-align: center; }
    .wallet-info-card .balance-details .balance-amount { color: var(--wallet-card-text-primary); font-size: 1.3rem; font-weight: 600; letter-spacing: -0.5px; margin-bottom: 2px; }
    .wallet-info-card .balance-details .balance-label { color: var(--wallet-card-text-secondary); font-size: 0.6rem; text-transform: uppercase; letter-spacing: 0.5px; opacity: 0.9; }
    .wallet-info-card .wallet-actions { display: flex; gap: 0.7rem; }
    .wallet-info-card .wallet-actions .action-button { background-color: var(--wallet-action-button-bg); color: var(--wallet-card-text-primary); border: 1px solid var(--wallet-action-button-border); font-weight: 500; padding: 0.4rem 0.8rem; border-radius: 5px; flex: 1; display: flex; align-items: center; justify-content: center; gap: 6px; font-size: 0.75rem; }
    .wallet-info-card .wallet-actions .action-button .material-symbols-outlined { font-size: 1rem; font-variation-settings: 'wght' 500; }
    .wallet-info-card .wallet-actions .action-button:hover { background-color: var(--wallet-action-button-hover-bg); border-color: var(--wallet-action-button-hover-border); }
    .weconnect-tool-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(240px, 1fr)); gap: 1rem; }
    .weconnect-tool-card { background-color: var(--surface-color); border-radius: var(--card-border-radius); padding: var(--card-padding); box-shadow: var(--card-shadow); border: 1px solid var(--border-color); position: relative; transition: transform var(--transition-speed) ease, box-shadow var(--transition-speed) ease, border-color var(--transition-speed) ease; }
    [data-theme="dark"] .weconnect-tool-card { border: 1px solid var(--border-color-dark); }
    .weconnect-tool-card:hover { transform: translateY(-3px); box-shadow: 0 3px 10px rgba(0,0,0,0.1); }
    [data-theme="dark"] .weconnect-tool-card:hover { border-color: var(--primary-color); box-shadow: 0 0 15px rgba(0, 255, 255, 0.12); }
    .weconnect-tool-card-header { display: flex; align-items: center; margin-bottom: 0.5rem; }
    .weconnect-tool-card-header i.fas, .weconnect-tool-card-header .material-symbols-outlined { font-size: 0.85rem; color: var(--primary-color); margin-right: 0.5rem; }
    [data-theme="dark"] .weconnect-tool-card-header i.fas, [data-theme="dark"] .weconnect-tool-card-header .material-symbols-outlined { color: var(--primary-color); }
    .weconnect-tool-card h3 { font-family: var(--font-display); font-size: var(--font-size-medium); font-weight: 600; color: var(--text-color); margin: 0; }
    .weconnect-tool-card p { font-family: var(--font-body); font-size: var(--font-size-card-description); color: var(--text-muted-color); margin-bottom: 0.6rem; line-height: 1.45; min-height: 2.8em; }
    .weconnect-tool-card .btn-launch { display: inline-block; background-color: var(--primary-color); color: var(--on-primary-color); padding: 0.35rem 0.7rem; border-radius: 4px; text-align: center; font-family: var(--font-display); font-size: 0.7rem; font-weight: 600; }
    .weconnect-tool-card .btn-launch:hover { background-color: var(--primary-variant-color); }
    [data-theme="dark"] .weconnect-tool-card .btn-launch { background-color: var(--primary-color); color: var(--on-primary-color-dark); }
    [data-theme="dark"] .weconnect-tool-card .btn-launch:hover { background-color: var(--primary-variant-color); }
    .trending-tag { position: absolute; top: 0.5rem; right: 0.5rem; background-color: var(--trending-bg); color: var(--trending-text); padding: 0.15rem 0.35rem; font-weight: 600; font-family: var(--font-display); border-radius: 3px; text-transform: uppercase; font-size: 0.58rem; letter-spacing: 0.5px; }
    [data-theme="dark"] .trending-tag { box-shadow: 0 0 3px var(--accent-color-dark); }
    #pageLoading { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(240, 242, 245, 0.9); display: flex; flex-direction: column; justify-content: center; align-items: center; z-index: 1001; transition: opacity 0.3s ease, visibility 0s linear 0.3s; }
    [data-theme="dark"] #pageLoading { background-color: rgba(13, 17, 23, 0.95); }
    #pageLoading.hidden { opacity: 0; visibility: hidden; }
    #pageLoading .loading-text { font-size: 1rem; font-weight: 500; color: var(--text-color); }
    #pageLoading .spinner { border: 3px solid rgba(0,0,0,0.1); border-top: 3px solid var(--primary-color); border-radius: 50%; width: 28px; height: 28px; animation: spin 0.8s linear infinite; margin-bottom: 12px; }
    [data-theme="dark"] #pageLoading .spinner { border-color: rgba(0,255,255,0.1); border-top-color: var(--primary-color); }
    @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    #aiToolContentContainer .ai-tool-wrapper-card { background-color: var(--surface-color); border: 1px solid var(--border-color); border-radius: var(--card-border-radius); padding: 1.5rem; margin-bottom: 1.5rem; box-shadow: var(--card-shadow); }
    [data-theme="dark"] #aiToolContentContainer .ai-tool-wrapper-card { border-color: var(--border-color-dark); }
    #aiToolContentContainer .ai-tool-wrapper-card h3 { font-size: 1.25rem; font-weight: 600; margin-bottom: 1rem; color: var(--text-color); }
    #aiToolContentContainer .ai-tool-wrapper-card label { display: block; margin-bottom: 0.5rem; font-weight: 500; color: var(--text-muted-color); }
    #aiToolContentContainer .output { margin-top: 1rem; padding: 1rem; background-color: var(--background-color); border: 1px solid var(--border-color); border-radius: 0.375rem; white-space: pre-wrap; word-wrap: break-word; color: var(--text-color); }
    [data-theme="light"] #aiToolContentContainer .output { background-color: #eef2ff; border: 1px solid #c7d2fe; }
    [data-theme="dark"] #aiToolContentContainer .output { background-color: rgba(0, 255, 255, 0.03); border: 1px solid rgba(0, 255, 255, 0.1); }
    #aiToolContentContainer .output img { max-width: 100%; height: auto; border-radius: 0.375rem; margin-top: 0.5rem; border: 1px solid var(--border-color); }
    #aiToolContentContainer .output audio { width: 100%; margin-top: 0.5rem; }
    #aiToolContentContainer .spinner { border: 4px solid rgba(0, 0, 0, .1); width: 36px; height: 36px; border-radius: 50%; border-left-color: var(--primary-color); animation: spin 1s ease infinite; margin: 1rem auto; display: none; }
    [data-theme="dark"] #aiToolContentContainer .spinner { border-color: rgba(255,255,255,0.1); border-left-color: var(--primary-color); }
    @media (max-width: 767px) { .sidebar { transform: translateX(-100%); } .sidebar.open { transform: translateX(0); box-shadow: 2px 0 12px rgba(0,0,0,0.08); } [data-theme="dark"] .sidebar.open { box-shadow: 2px 0 15px rgba(0, 255, 255, 0.08); } .main-wrapper { margin-left: 0 !important; } .app-title-topbar { display: none; } .content-area { padding: 0.8rem; } .weconnect-tool-grid { grid-template-columns: 1fr; gap: 0.8rem; } .btn-upgrade span { display: none; } .btn-upgrade i.fas { margin-right: 0; } .topbar { padding: 0 0.8rem; } }
  </style>
</head>
<body>
    <div id="pageLoading"> <div class="spinner"></div> <p class="loading-text">Loading WeConnect...</p> </div>
    <div class="app-container">
    <aside class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <img src="https://firebasestorage.googleapis.com/v0/b/daisy-n7g20a.appspot.com/o/wconnect.png?alt=media&token=b7bcc6ee-f8dc-44a2-a6d6-7c713f6f3eff" alt="WeConnect Logo" class="logo">
            <span class="app-title-sidebar">WeConnect</span>
        </div>
        <nav class="sidebar-nav">
            <ul>
                <li class="nav-heading">Main</li>
                <li><a href="#" class="main-nav-link active" data-section="dashboard"><i class="fas fa-tachometer-alt"></i><span>Dashboard</span></a></li>
                <li><a href="#" class="main-nav-link" data-section="all-ai-creator-tools"><i class="fas fa-magic"></i><span>AI Creator Suite</span></a></li>
                <li><a href="#" class="main-nav-link" data-section="favorites"><i class="fas fa-star"></i><span>Favorites</span></a></li>

                <li class="nav-heading">WeConnect Platform</li>
                <li><a href="#" class="main-nav-link platform-tool-link" data-tool-id="weconnect-ai-text-editor"><i class="fas fa-edit"></i><span>AI Text Editor</span></a></li>
                <li><a href="#" class="main-nav-link platform-tool-link" data-tool-id="weconnect-ai-image-generator"><i class="fas fa-image"></i><span>AI Image Generator</span></a></li>
                <li><a href="#" class="main-nav-link platform-tool-link" data-tool-id="weconnect-ai-video-generator"><i class="fas fa-video"></i><span>AI Video Generator</span></a></li>
                <li><a href="#" class="main-nav-link platform-tool-link" data-tool-id="weconnect-voice-cloner"><i class="fas fa-microphone-alt"></i><span>Voice Cloner</span></a></li>
                <li><a href="#" class="main-nav-link platform-tool-link" data-tool-id="weconnect-chat-with-ai"><i class="fas fa-comments"></i><span>Chat with AI</span></a></li>
                <li><a href="#" class="main-nav-link platform-tool-link" data-tool-id="weconnect-translator"><i class="fas fa-globe-americas"></i><span>Translator</span></a></li>
                
                <li class="nav-heading" id="aiCreatorSuiteNavHeader">AI Creator Suite Tools</li>
                <div id="aiCreatorSuiteNavLinks"> <!-- Populated by JS --> </div>

                <li class="nav-heading">User</li>
                <li><a href="#" class="main-nav-link" data-section="profile"><i class="fas fa-user-circle"></i><span>My Profile</span></a></li>
                <li><a href="#" class="main-nav-link" data-section="settings"><i class="fas fa-cog"></i><span>Settings</span></a></li>
                <li><a href="#" class="main-nav-link" data-section="support"><i class="fas fa-life-ring"></i><span>Support</span></a></li>
                <li><a href="#" id="signOutLink"><i class="fas fa-sign-out-alt"></i><span>Logout</span></a></li>
            </ul>
        </nav>
    </aside>

    <div class="main-wrapper">
        <header class="topbar">
            <div class="topbar-left">
                <button class="hamburger-btn" id="hamburgerBtn" aria-label="Toggle Menu"> <i class="fas fa-bars"></i> </button>
                <h1 class="app-title-topbar" id="topbarTitle">WeConnect Dashboard</h1>
            </div>
            <div class="topbar-right">
                <button class="btn btn-upgrade"><i class="fas fa-rocket"></i> <span>Upgrade</span></button>
                <button class="theme-toggle-btn" id="themeToggleBtn" aria-label="Toggle Theme"> <i class="fas fa-moon"></i> </button>
                <div class="profile-menu"> <span class="material-symbols-outlined" style="cursor:pointer; font-size: 22px;" id="profileMenuIcon" title="Profile Options">account_circle</span> </div>
            </div>
        </header>

        <main class="content-area">
            <div class="wallet-info-card" id="walletCard">
              <div class="wallet-info-card-header">
                <div class="user-info"> <div class="user-name" id="userName">Welcome, Loading...</div> <div class="user-id" id="memberId">ID: Loading...</div> </div>
                <div class="card-chip"></div>
              </div>
              <div class="balance-details">
                <div class="balance-source"> <div class="balance-amount" id="unilevelIncome">₱0.00</div> <div class="balance-label">Wallet Balance</div> </div>
                <div class="balance-source"> <div class="balance-amount" id="tokenBalance">0.00</div> <div class="balance-label">WCX Token</div> </div>
              </div>
              <div class="wallet-actions">
                <button id="historyButton" class="action-button"> <span class="material-symbols-outlined">history</span> History </button>
                <button id="connectButton" class="action-button"> <span class="material-symbols-outlined">link</span> Connect </button>
              </div>
            </div>

            <div class="content-header" id="mainContentHeader"> <h2>Dashboard Tools</h2> <p>Explore our collection of AI-powered tools.</p> </div>
            <div class="weconnect-tool-grid" id="weconnectToolGrid"> <!-- WeConnect Platform Tool cards --> </div>
            <div id="apiKeyNotice" class="ai-tool-wrapper-card bg-yellow-50 border-yellow-300 my-4 p-4 hidden"> <!-- API Key Notice (initially hidden) --> </div>
            <div id="aiToolContentContainer" class="hidden"> <div class="ai-tool-wrapper-card" id="currentAiToolWrapper"> <!-- Active AI Tool UI --> </div> </div>
        </main>
    </div>
</div>

<script>
    const firebaseConfig = { /* Firebase Config ... */
        apiKey: "AIzaSyDwldURmtljNpORmpGRacwXriPmQZjF6j8",
        authDomain: "daisy-n7g20a.firebaseapp.com",
        databaseURL: "https://daisy-n7g20a-default-rtdb.firebaseio.com",
        projectId: "daisy-n7g20a",
        storageBucket: "daisy-n7g20a.appspot.com",
        messagingSenderId: "225362605902",
        appId: "1:225362605902:web:d2551cc389e78c92c3d01f"
    };
    if (!firebase.apps.length) { firebase.initializeApp(firebaseConfig); }
    const auth = firebase.auth();
    const db = firebase.firestore();

    const TOGETHER_API_KEY = "3b1c02603a0137c8c8b265ef1ed02c3e448c089a44f052ca6acf54210fa6b34c";
    const DEEPGRAM_API_KEY = "5431a4360985a2cd68978b3b2908c13bca576830";
    const MODELS = {
        imageGen: "black-forest-labs/FLUX.1-schnell-Free",
        chatCompletion: "meta-llama/Llama-3.3-70B-Instruct-Turbo-Free",
        thinking: "deepseek-ai/DeepSeek-R1-Distill-Llama-70B-free",
        vision: "meta-llama/Llama-Vision-Free"
    };

    const pageLoadingElement = document.getElementById('pageLoading');
    const themeToggleBtn = document.getElementById('themeToggleBtn');
    const sidebar = document.getElementById('sidebar');
    const hamburgerBtn = document.getElementById('hamburgerBtn');
    const mainWrapper = document.querySelector('.main-wrapper');
    const userNameElement = document.getElementById('userName');
    const memberIdElement = document.getElementById('memberId');
    const walletBalanceElement = document.getElementById('unilevelIncome');
    const tokenBalanceDisplayElement = document.getElementById('tokenBalance');
    const historyButton = document.getElementById('historyButton');
    const connectButton = document.getElementById('connectButton');
    const signOutLinkSidebar = document.getElementById('signOutLink');
    const profileMenuIcon = document.getElementById('profileMenuIcon');
    const weConnectToolGrid = document.getElementById('weConnectToolGrid');
    const aiToolContentContainer = document.getElementById('aiToolContentContainer');
    const currentAiToolWrapper = document.getElementById('currentAiToolWrapper');
    const mainContentHeader = document.getElementById('mainContentHeader');
    const apiKeyNotice = document.getElementById('apiKeyNotice');
    const topbarTitle = document.getElementById('topbarTitle');


    // --- Theme Logic ---
    function applyTheme(theme) { /* ... same as before ... */
        if (theme === 'dark') {
            document.documentElement.setAttribute('data-theme', 'dark');
            if (themeToggleBtn) themeToggleBtn.innerHTML = '<i class="fas fa-sun"></i>';
        } else {
            document.documentElement.removeAttribute('data-theme');
            if (themeToggleBtn) themeToggleBtn.innerHTML = '<i class="fas fa-moon"></i>';
        }
        localStorage.setItem('theme', theme);
    }
    function initTheme() { applyTheme(localStorage.getItem('theme') || 'light'); }
    if (themeToggleBtn) themeToggleBtn.addEventListener('click', () => {
        const currentTheme = document.documentElement.hasAttribute('data-theme') ? 'dark' : 'light';
        applyTheme(currentTheme === 'light' ? 'dark' : 'light');
    });

    // --- Sidebar Logic ---
    function toggleSidebar() { /* ... same as before ... */
        if (!sidebar || !mainWrapper) return;
        const isMobile = window.innerWidth <= 767;
        if (isMobile) sidebar.classList.toggle('open');
        else sidebar.classList.toggle('collapsed');
    }
    function setInitialSidebarState() { /* ... same as before ... */
        if (!sidebar || !mainWrapper) return;
        const isMobile = window.innerWidth <= 767;
        if (isMobile) sidebar.classList.remove('collapsed', 'open');
        else sidebar.classList.remove('open');
    }
    if (hamburgerBtn) hamburgerBtn.addEventListener('click', toggleSidebar);
    document.addEventListener('click', function(event) {
        if (window.innerWidth <= 767 && sidebar && sidebar.classList.contains('open') && !sidebar.contains(event.target) && hamburgerBtn && !hamburgerBtn.contains(event.target)) {
            sidebar.classList.remove('open');
        }
    });
    window.addEventListener('resize', setInitialSidebarState);

    // --- Firebase User Data & Wallet ---
    function formatCurrency(amount, includeSymbol = true, currency = '₱') { /* ... same as before ... */
        const numericAmount = Number(amount) || 0;
        const formatted = numericAmount.toFixed(2).replace(/\B(?=(\d{3})+(?!\d))/g, ',');
        return includeSymbol ? currency + formatted : formatted;
    }
    async function fetchAndDisplayUserData(user) { /* ... same as before ... */
        if (!user) { if(pageLoadingElement) pageLoadingElement.classList.add('hidden'); return; }
        try {
            const userDoc = await db.collection('users').doc(user.uid).get();
            if (userDoc.exists) {
                const userData = userDoc.data();
                const displayName = user.displayName || userData.displayName || 'User';
                if(userNameElement) userNameElement.textContent = `${displayName}`;
                if(memberIdElement) memberIdElement.textContent = `ID: ${userData.memberId || 'N/A'}`;
                const mainBalance = userData.balance ?? userData.php_balance ?? userData.unilevel_income ?? 0;
                if(walletBalanceElement) walletBalanceElement.textContent = formatCurrency(mainBalance);
                if(tokenBalanceDisplayElement) tokenBalanceDisplayElement.textContent = formatCurrency(userData.token_balance ?? userData.wcx_token_balance ?? 0, false);
            } else {
                if(userNameElement) userNameElement.textContent = `${user.displayName || 'User'}`;
                if(memberIdElement) memberIdElement.textContent = `ID: Not Found`;
            }
        } catch (error) { console.error("Error fetching user data:", error); if(userNameElement) userNameElement.textContent = `Error`; }
        finally { if(pageLoadingElement) pageLoadingElement.classList.add('hidden'); }
    }
    auth.onAuthStateChanged((user) => { /* ... same as before ... */
        if (user) { fetchAndDisplayUserData(user); }
        else {
            if(pageLoadingElement) pageLoadingElement.classList.add('hidden');
            if(userNameElement) userNameElement.textContent = 'Guest';
            if(memberIdElement) memberIdElement.textContent = 'ID: N/A';
            if(walletBalanceElement) walletBalanceElement.textContent = formatCurrency(0);
            if(tokenBalanceDisplayElement) tokenBalanceDisplayElement.textContent = formatCurrency(0, false);
            console.log("User is signed out or not authenticated. Redirecting to signin.html if not already there.");
            if (!window.location.pathname.endsWith('signin.html') && !window.location.pathname.endsWith('signup.html')) {
                 // window.location.href = 'signin.html'; // Uncomment to enforce sign-in
            }
        }
    });
    async function handleSignOut() { /* ... same as before ... */
         if (confirm("Are you sure you want to sign out?")) {
            try {
                if(pageLoadingElement) { pageLoadingElement.classList.remove('hidden'); pageLoadingElement.querySelector('.loading-text').textContent = 'Signing out...'; }
                await auth.signOut();
                // Redirect to signin page after successful logout
                window.location.href = 'signin.html';
            } catch (error) { console.error("Error signing out:", error); alert("Failed to sign out."); if(pageLoadingElement) pageLoadingElement.classList.add('hidden'); }
        }
    }
    if(historyButton) historyButton.addEventListener('click', () => alert('History Clicked!'));
    if(connectButton) connectButton.addEventListener('click', () => alert('Connect Clicked!'));
    if(signOutLinkSidebar) signOutLinkSidebar.addEventListener('click', (e) => { e.preventDefault(); handleSignOut(); });
    if(profileMenuIcon) profileMenuIcon.addEventListener('click', () => alert('Profile Menu Icon Clicked! Implement dropdown or navigation.'));


    // --- WeConnect Platform Tools (Original List from new HTML) ---
    const weConnectPlatformTools = [
        { id: 'weconnect-ai-text-editor', name: 'AI Text Editor (Platform)', description: 'Enhance writing with AI grammar checks & style suggestions.', icon: 'fas fa-edit', trending: true, sectionId: 'ai-text-editor' },
        { id: 'weconnect-ai-image-generator', name: 'AI Image Generator (Platform)', description: 'Create unique images from text prompts using AI models.', icon: 'fas fa-image', trending: true, sectionId: 'ai-image-generator' },
        { id: 'weconnect-ai-video-generator', name: 'AI Video Generator (Platform)', description: 'Produce videos from scripts with AI voiceovers & visuals.', icon: 'fas fa-video', sectionId: 'ai-video-generator' },
        { id: 'weconnect-voice-cloner', name: 'Voice Cloner (Platform)', description: 'Clone voices for narrations and content creation.', icon: 'fas fa-microphone-alt', sectionId: 'voice-cloner' },
        { id: 'weconnect-chat-with-ai', name: 'Chat with AI (Platform)', description: 'Intelligent conversations, get answers, brainstorm ideas.', icon: 'fas fa-comments', sectionId: 'chat-with-ai' },
        { id: 'weconnect-translator', name: 'Translator (Platform)', description: 'Translate text between languages with high accuracy.', icon: 'fas fa-globe-americas', trending: true, sectionId: 'translator' }
    ];

    function renderWeConnectPlatformToolCard(tool) {
        const card = document.createElement('div');
        card.classList.add('weconnect-tool-card', 'cursor-pointer'); // Make card clickable
        card.dataset.sectionId = tool.sectionId; // Link to section
        let trendingTagHtml = tool.trending ? '<span class="trending-tag">Trending</span>' : '';
        card.innerHTML = `
            ${trendingTagHtml}
            <div class="weconnect-tool-card-header">
                <i class="${tool.icon || 'fas fa-tools'}"></i>
                <h3>${tool.name}</h3>
            </div>
            <p>${tool.description}</p>
            <button class="btn btn-launch">Launch</button> <!-- Button can also trigger section change -->
        `;
        card.addEventListener('click', () => {
            // Placeholder: In a real app, this would navigate to the tool's dedicated page or view
            alert(`Launching WeConnect Platform Tool: ${tool.name}. This would navigate to its dedicated section/page.`);
            // For now, let's treat it like a section navigation if a sectionId exists
            const navLink = document.querySelector(`.main-nav-link[data-section="${tool.sectionId}"]`);
            if (navLink) {
                navLink.click();
            }
        });
        return card;
    }

    function displayWeConnectPlatformTools(tools) {
        if (!weConnectToolGrid) return;
        weConnectToolGrid.innerHTML = '';
        tools.forEach(tool => weConnectToolGrid.appendChild(renderWeConnectPlatformToolCard(tool)));
    }


    // --- AI Creator Suite Tool Definitions (Expanded) ---
    const aiCreatorToolsDefinitions = [
        // Original Tools (first 11, mapped to new structure)
        { id: 'image-browser-cs', icon: 'photo_library', name: 'Image Browser (Suite)', description: 'Find free, high-quality stock photos.', type: 'placeholder_suite', details: 'This tool would integrate an image browsing API like Pexels or Unsplash.' },
        { id: 'hashtag-generator-cs', icon: 'tag', name: 'Hashtag Generator (Suite)', description: 'Discover relevant hashtags from text or image.', type: 'llm_vision_chat', model: MODELS.chatCompletion, visionModel: MODELS.vision,
          fields: [ { id: 'hg_text_cs', label: 'Enter text (optional):', type: 'textarea', placeholder: 'e.g., My travel adventure in Paris' }, { id: 'hg_image_cs', label: 'Upload image (optional):', type: 'file', accept: 'image/*' } ],
          prompt: (inputs) => `Based on the context: "${inputs.hg_text_cs || ''}${inputs.hg_image_cs_desc ? (inputs.hg_text_cs ? ' ' : '') + 'Image context: ' + inputs.hg_image_cs_desc : ''}", generate a list of 10-15 relevant and effective hashtags. Mix popular and niche if appropriate.`
        },
        { id: 'ai-topic-ideas-cs', icon: 'lightbulb', name: 'AI Topic Ideas (Suite)', description: 'Get creative content suggestions.', type: 'llm_chat', model: MODELS.chatCompletion,
          fields: [ { id: 'ati_keyword_cs', label: 'Enter a keyword or topic:', type: 'text', placeholder: 'e.g., Sustainable Living' } ],
          prompt: (inputs) => `Generate 5 engaging content topic ideas (e.g., blog posts, videos) based on the keyword: "${inputs.ati_keyword_cs}". For each, provide a brief (1-sentence) concept.`
        },
        { id: 'ai-image-generator-cs', icon: 'auto_awesome', name: 'AI Image Generator (Suite)', description: 'Generate images from text prompts.', type: 'llm_image', model: MODELS.imageGen,
          fields: [ { id: 'aig_prompt_cs', label: 'Enter your image prompt:', type: 'textarea', placeholder: 'e.g., A futuristic cityscape at sunset' } ]
        },
        { id: 'ai-title-creator-cs', icon: 'title', name: 'AI Title Creator (Suite)', description: 'Craft catchy and optimized titles.', type: 'llm_chat', model: MODELS.chatCompletion,
          fields: [ { id: 'atc_content_cs', label: 'Briefly describe your content or topic:', type: 'textarea', placeholder: 'e.g., A video about making homemade pasta' } ],
          prompt: (inputs) => `Generate 5 catchy and SEO-friendly titles for content described as: "${inputs.atc_content_cs}".`
        },
        { id: 'ai-description-writer-cs', icon: 'article', name: 'AI Description Writer (Suite)', description: 'Generate compelling video/post descriptions.', type: 'llm_chat', model: MODELS.chatCompletion,
          fields: [ { id: 'adw_title_cs', label: 'Content Title or Topic:', type: 'text', placeholder: 'e.g., My Trip to the Mountains' }, {id: 'adw_keywords_cs', label: 'Keywords (optional, comma-separated):', type: 'text', placeholder: 'hiking, nature, adventure'} ],
          prompt: (inputs) => `Write a compelling and engaging description (approx. 100-150 words) for content titled "${inputs.adw_title_cs}". ${inputs.adw_keywords_cs ? 'Incorporate these keywords if natural: ' + inputs.adw_keywords_cs + '.' : ''} Include a call to action if appropriate.`
        },
        { id: 'tts-cs', icon: 'record_voice_over', name: 'Text-to-Speech (Suite)', description: 'Convert text into voiceovers using Deepgram.', type: 'deepgram_tts',
          fields: [ { id: 'tts_text_cs', label: 'Enter text to convert to speech:', type: 'textarea', placeholder: 'Hello, this is a test of WeConnect text to speech.' } ]
        },
        { id: 'stt-cs', icon: 'mic', name: 'Speech-to-Text (Suite)', description: 'Transcribe audio to text using Deepgram.', type: 'deepgram_stt',
          fields: [ { id: 'stt_audio_cs', label: 'Upload audio file (MP3, WAV, etc.):', type: 'file', accept: 'audio/*' } ]
        },
        { id: 'local-storage-cs', icon: 'folder_open', name: 'Local Storage Manager (Suite)', description: 'Manage app-stored content/files.', type: 'placeholder_suite', details: 'Client-side tool to view/manage localStorage for this app.' },
        { id: 'color-palette-cs', icon: 'palette', name: 'Color Palette Generator (Suite)', description: 'Create/extract harmonious color schemes.', type: 'llm_vision_chat', model: MODELS.chatCompletion, visionModel: MODELS.vision,
            fields: [ {id: 'cp_image_cs', label: 'Upload image to extract palette (optional):', type: 'file', accept: 'image/*'}, { id: 'cp_description_cs', label: 'Or describe desired palette:', type: 'text', placeholder: 'e.g., earthy tones with a pop of teal' } ],
            prompt: (inputs) => `Generate a harmonious color palette of 5 colors. ${inputs.cp_description_cs ? 'Base it on the description: "' + inputs.cp_description_cs + '". ' : ''} ${inputs.cp_image_cs_desc ? 'Also consider this image description: "' + inputs.cp_image_cs_desc + '". ' : ''} Provide hex codes for each color and a brief name (e.g., "Deep Ocean Blue - #003366"). If an image was provided, prioritize colors from it.`
        },
        { id: 'font-pairer-cs', icon: 'text_fields', name: 'Font Pairer (Suite)', description: 'Find complementary font combinations.', type: 'placeholder_suite', details: 'Client-side tool to suggest font pairings from Google Fonts or similar.' },

        // AI-Connect Inspired & New Tools (Continued, ensuring >50 total)
        { id: 'blog-idea-generator-adv-cs', icon: 'tips_and_updates', name: 'Advanced Blog Idea Generator (Suite)', description: 'Generates detailed blog post ideas with subheadings.', type: 'llm_chat', model: MODELS.chatCompletion,
          fields: [ { id: 'big_topic_adv_cs', label: 'Enter a keyword or topic:', type: 'text', placeholder: 'e.g., AI in Education' } ],
          prompt: (inputs) => `Generate 5 detailed blog post ideas for the topic: "${inputs.big_topic_adv_cs}". For each idea, provide: a catchy title, a 2-3 sentence concept/summary, and 3-4 potential subheadings or key points to cover.`
        },
        { id: 'social-media-caption-writer-cs', icon: 'edit_note', name: 'Social Media Caption Writer (Suite)', description: 'Creates captions for various platforms.', type: 'llm_chat', model: MODELS.chatCompletion,
          fields: [ { id: 'smcw_topic_cs', label: 'Brief description or topic:', type: 'text', placeholder: 'e.g., New product launch photo' }, { id: 'smcw_platform_cs', label: 'Platform:', type: 'select', options: ['Instagram', 'Twitter (X)', 'LinkedIn', 'Facebook', 'TikTok'] } ],
          prompt: (inputs) => `Write 3 engaging social media captions for ${inputs.smcw_platform_cs} about "${inputs.smcw_topic_cs}". Include relevant emojis and suggest 2-3 popular hashtags for each.`
        },
        { id: 'video-script-hook-creator-cs', icon: 'movie', name: 'Video Script Hook Creator (Suite)', description: 'Generates attention-grabbing video hooks.', type: 'llm_chat', model: MODELS.chatCompletion,
          fields: [ { id: 'vshc_topic_cs', label: 'Video topic:', type: 'text', placeholder: 'e.g., 10 Unknown Facts About Space' } ],
          prompt: (inputs) => `Generate 5 compelling opening hooks (1-2 sentences each) for a video about "${inputs.vshc_topic_cs}". Make them intriguing and attention-grabbing.`
        },
        { id: 'image-prompt-enhancer-cs', icon: 'auto_fix_high', name: 'Image Prompt Enhancer (Suite)', description: 'Enhances simple image prompts.', type: 'llm_chat', model: MODELS.thinking,
          fields: [ { id: 'ipe_prompt_cs', label: 'Enter your simple image prompt:', type: 'text', placeholder: 'e.g., cat on a roof' } ],
          prompt: (inputs) => `Enhance the following simple image generation prompt: "${inputs.ipe_prompt_cs}". Provide 3 detailed and artistic variations. Focus on adding details about style (e.g., photorealistic, oil painting, anime), lighting (e.g., golden hour, neon), composition, mood, and specific elements. Each variation should be a complete, ready-to-use prompt.`
        },
        { id: 'image-describer-cs', icon: 'visibility', name: 'Image Describer (Suite)', description: 'Describes the content of an uploaded image.', type: 'llm_vision', model: MODELS.vision,
          fields: [ { id: 'id_image_cs', label: 'Upload an image:', type: 'file', accept: 'image/*' } ],
          promptFromVision: (imageDesc) => imageDesc // Vision output is the description
        },
        { id: 'podcast-title-suggester-cs', icon: 'podcasts', name: 'Podcast Title Suggester (Suite)', description: 'Suggests creative podcast episode titles.', type: 'llm_chat', model: MODELS.chatCompletion,
          fields: [ { id: 'pts_topic_cs', label: 'Episode topic or summary:', type: 'textarea', placeholder: 'e.g., Interview with a pioneering AI researcher on the future of AGI' } ],
          prompt: (inputs) => `Generate 5 creative and engaging podcast episode titles for a show about: "${inputs.pts_topic_cs}". Consider different angles (e.g., intriguing, benefit-driven, controversial).`
        },
        { id: 'email-subject-generator-cs', icon: 'mail_outline', name: 'Email Subject Generator (Suite)', description: 'Generates compelling email subject lines.', type: 'llm_chat', model: MODELS.chatCompletion,
          fields: [ { id: 'esg_summary_cs', label: 'Email content summary or goal:', type: 'text', placeholder: 'e.g., Announcing a 20% off sale on all tech gadgets' } ],
          prompt: (inputs) => `Generate 5 compelling email subject lines for an email with the content/goal: "${inputs.esg_summary_cs}". Aim for high open rates, using curiosity, urgency, or clear benefits.`
        },
        { id: 'video-script-scene-summarizer-cs', icon: 'segment', name: 'Video Script Scene Summarizer (Suite)', description: 'Summarizes video script scenes.', type: 'llm_chat', model: MODELS.thinking,
          fields: [ { id: 'vsss_scene_cs', label: 'Paste script scene:', type: 'textarea', placeholder: 'INT. COFFEE SHOP - DAY\nAVA (30s) sips her latte, lost in thought. LIAM (30s) enters, looking hurried...' } ],
          prompt: (inputs) => `Summarize the following video script scene in 2-3 sentences, focusing on key actions, character interactions, and plot progression: \n\n${inputs.vsss_scene_cs}`
        },
        { id: 'content-paraphraser-cs', icon: 'shuffle', name: 'Content Paraphraser (Suite)', description: 'Paraphrases text while maintaining meaning.', type: 'llm_chat', model: MODELS.chatCompletion,
          fields: [ { id: 'paraphrase_text_cs', label: 'Paste text to paraphrase:', type: 'textarea', placeholder: 'The quick brown fox jumps over the lazy dog.' } ],
          prompt: (inputs) => `Paraphrase the following text, ensuring the original meaning is fully preserved but using significantly different wording and sentence structure. Provide 2-3 variations if the text is long enough:\n\n${inputs.paraphrase_text_cs}`
        },
        { id: 'text-summarizer-cs', icon: 'compress', name: 'Text Summarizer (Suite)', description: 'Summarizes text concisely.', type: 'llm_chat', model: MODELS.thinking,
          fields: [ { id: 'summarize_text_input_cs', label: 'Paste text to summarize (up to 500 words):', type: 'textarea', placeholder: 'Enter your text here...' } ],
          prompt: (inputs) => `Summarize the following text concisely (aim for 15-25% of original length, or 2-4 sentences for shorter texts):\n\n${inputs.summarize_text_input_cs}`
        },
        { id: 'grammar-tone-check-cs', icon: 'spellcheck', name: 'Grammar & Tone Check (Suite)', description: 'Checks grammar and assesses tone.', type: 'llm_chat', model: MODELS.chatCompletion,
          fields: [ { id: 'gtc_text_cs', label: 'Paste text for grammar & tone check:', type: 'textarea', placeholder: 'Their going to the park. Its a beautiful day!' } ],
          prompt: (inputs) => `Analyze the following text for grammar errors and assess its overall tone. Provide corrections for any grammar mistakes. Describe the tone (e.g., formal, informal, friendly, assertive, sarcastic, etc.) and suggest improvements if the tone seems inappropriate for general professional communication. Text:\n\n"${inputs.gtc_text_cs}"`
        },
        { id: 'image-alt-text-generator-cs', icon: 'closed_caption', name: 'Image Alt-Text Generator (Suite)', description: 'Generates descriptive alt-text for images.', type: 'llm_vision_chat', model: MODELS.chatCompletion, visionModel: MODELS.vision,
          fields: [ { id: 'iatg_image_cs', label: 'Upload image for alt-text:', type: 'file', accept: 'image/*' } ],
          prompt: (inputs) => `Based on the image described as: "${inputs.iatg_image_cs_desc}", generate concise and descriptive alt text suitable for web accessibility. Focus on the main subject and context.`
        },
        { id: 'keyword-extractor-cs', icon: 'key', name: 'Keyword Extractor (Suite)', description: 'Extracts main keywords from text.', type: 'llm_chat', model: MODELS.chatCompletion,
          fields: [ { id: 'ke_text_cs', label: 'Paste text to extract keywords:', type: 'textarea', placeholder: 'Artificial intelligence is transforming various industries, from healthcare to finance...' } ],
          prompt: (inputs) => `Extract the top 5-10 main keywords and key phrases (single or multi-word) from the following text. List them clearly:\n\n${inputs.ke_text_cs}`
        },
        { id: 'readability-estimator-cs', icon: 'visibility_auto', name: 'Readability Estimator (Suite)', description: 'Estimates text readability.', type: 'llm_chat', model: MODELS.thinking,
          fields: [ { id: 're_text_cs', label: 'Paste text to estimate readability:', type: 'textarea', placeholder: 'Enter text to analyze its complexity...' } ],
          prompt: (inputs) => `Analyze the following text and provide an estimated Flesch-Kincaid Grade Level. Also, give a brief qualitative assessment of its readability (e.g., "Easy to read for a general audience", "Fairly complex, suitable for an academic audience", "Very technical, requires expert knowledge"). Text:\n\n"${inputs.re_text_cs}"`
        },
        { id: 'text-sentiment-checker-cs', icon: 'mood', name: 'Text Sentiment Checker (Suite)', description: 'Checks sentiment of text snippets.', type: 'llm_chat', model: MODELS.chatCompletion,
          fields: [ { id: 'tsc_text_single_cs', label: 'Paste text snippet for sentiment analysis:', type: 'text', placeholder: 'e.g., I love this product!' } ],
          prompt: (inputs) => `Analyze the sentiment of the following text. Classify it as Positive, Negative, or Neutral. Provide a brief explanation for your classification. Text: "${inputs.tsc_text_single_cs}"`
        },
        { id: 'tweet-snippet-creator-cs', icon: 'chat_bubble_outline', name: 'Tweet Snippet Creator (Suite)', description: 'Creates tweet-sized snippets from text.', type: 'llm_chat', model: MODELS.chatCompletion,
          fields: [ { id: 'twsc_paragraph_cs', label: 'Paste a paragraph or long text:', type: 'textarea', placeholder: 'One key takeaway from our recent research is that consistent branding across all platforms leads to higher customer recall and trust...' } ],
          prompt: (inputs) => `Take the following text and generate 2-3 tweet options (under 280 characters each) that summarize its key point or offer an engaging hook related to it. Include 1-2 relevant hashtags for each tweet.\n\nText: "${inputs.twsc_paragraph_cs}"`
        },
        { id: 'quote-finder-from-text-cs', icon: 'format_quote', name: 'Quote Finder from Text (Suite)', description: 'Extracts impactful sentences.', type: 'llm_chat', model: MODELS.chatCompletion,
          fields: [ { id: 'qfft_text_cs', label: 'Paste text to find quotable sentences:', type: 'textarea', placeholder: 'Enter a larger block of text here...' } ],
          prompt: (inputs) => `From the following text, extract 3-5 impactful, insightful, or highly quotable sentences. Present them as a list.\n\nText:\n${inputs.qfft_text_cs}`
        },
        { id: 'faq-generator-cs', icon: 'quiz', name: 'FAQ Generator (Suite)', description: 'Generates FAQs from content.', type: 'llm_chat', model: MODELS.chatCompletion,
          fields: [ { id: 'fg_content_cs', label: 'Paste content to generate FAQs from:', type: 'textarea', placeholder: 'Enter your article, product description, or service details...' } ],
          prompt: (inputs) => `Based on the following content, generate a list of 3-5 frequently asked questions (FAQs) along with their concise answers derived directly from the text. Format as: Q: [Question]\nA: [Answer]\n\nContent:\n${inputs.fg_content_cs}`
        },
        { id: 'eli5-text-simplifier-cs', icon: 'child_care', name: 'ELI5 Text Simplifier (Suite)', description: 'Explains complex text in simple terms.', type: 'llm_chat', model: MODELS.chatCompletion,
          fields: [ { id: 'eli5_text_cs', label: 'Paste complex text to simplify:', type: 'textarea', placeholder: 'Quantum entanglement is a physical phenomenon...' } ],
          prompt: (inputs) => `Explain the following text as if you were talking to a 5-year-old. Use very simple words, short sentences, and relatable analogies if possible.\n\nText: "${inputs.eli5_text_cs}"`
        },
        { id: 'feature-to-benefit-converter-cs', icon: 'sync_alt', name: 'Feature to Benefit Converter (Suite)', description: 'Converts product features into benefits.', type: 'llm_chat', model: MODELS.chatCompletion,
          fields: [ { id: 'ftb_features_cs', label: 'List product features (one per line):', type: 'textarea', placeholder: 'e.g., Durable material\nLong battery life\nLightweight design\n1080p HD display' } ],
          prompt: (inputs) => `For each product feature listed below, describe the primary benefit it provides to the customer. Focus on "what's in it for them" and the value they get. Format as:\nFeature: [Feature]\nBenefit: [Benefit]\n\nFeatures:\n${inputs.ftb_features_cs}`
        },
        { id: 'call-to-action-generator-cs', icon: 'ads_click', name: 'Call-to-Action Generator (Suite)', description: 'Generates compelling CTAs.', type: 'llm_chat', model: MODELS.chatCompletion,
          fields: [ { id: 'ctag_context_cs', label: 'Describe content/goal for CTA:', type: 'text', placeholder: 'e.g., Sign up for newsletter about AI tools' } ],
          prompt: (inputs) => `Generate 5 compelling Call-to-Action (CTA) phrases related to: "${inputs.ctag_context_cs}". Make them short, action-oriented, and persuasive. Vary the style (e.g., direct, benefit-driven, curiosity-driven).`
        },
        { id: 'intent-spotter-cs', icon: 'saved_search', name: 'Intent Spotter (Suite)', description: 'Identifies user intent from short text.', type: 'llm_chat', model: MODELS.thinking,
          fields: [ { id: 'is_text_cs', label: 'Enter short text to spot intent:', type: 'text', placeholder: 'e.g., How do I reset my password?' } ],
          prompt: (inputs) => `Analyze the following user query and identify the primary intent. Examples of intents: "Find Information", "Make a Purchase", "Get Support", "Compare Options", "Provide Feedback", "Navigate". Query: "${inputs.is_text_cs}"\n\nIdentified Intent: [Your classification]\nBrief Rationale: [Why you chose this intent]`
        },
        { id: 'poll-quiz-question-generator-cs', icon: 'poll', name: 'Poll/Quiz Question Generator (Suite)', description: 'Generates poll/quiz questions.', type: 'llm_chat', model: MODELS.chatCompletion,
          fields: [ { id: 'pqqg_topic_cs', label: 'Topic for poll/quiz question:', type: 'text', placeholder: 'e.g., Favorite programming language' }, { id: 'pqqg_type_cs', label: 'Type:', type: 'select', options: ['Poll Question', 'Quiz Question (with answer)'] } ],
          prompt: (inputs) => { /* ... same prompt logic as before, using inputs.pqqg_topic_cs etc. ... */
            if (inputs.pqqg_type_cs === "Poll Question") {
                return `Generate a single, engaging poll question about "${inputs.pqqg_topic_cs}" with 3-4 plausible and distinct answer options. Format as:\nQuestion: [Question]\nOptions:\n- [Option 1]\n- [Option 2]\n- [Option 3]\n- [Option 4 (optional)]`;
            } else {
                return `Generate a single, interesting quiz question about "${inputs.pqqg_topic_cs}" with 3-4 plausible answer options, one of which is correct. Clearly indicate the correct answer. Format as:\nQuestion: [Question]\nOptions:\nA) [Option A]\nB) [Option B]\nC) [Option C]\nD) [Option D (optional)]\nCorrect Answer: [Letter of correct option] - [Correct Option Text]`;
            }
          }
        },
        { id: 'product-description-crafter-cs', icon: 'inventory_2', name: 'Product Description Crafter (Suite)', description: 'Creates persuasive product descriptions.', type: 'llm_chat', model: MODELS.chatCompletion,
          fields: [ {id: 'pdc_name_cs', label: 'Product Name:', type: 'text', placeholder: 'e.g., QuantumLeap Smartwatch X1'}, {id: 'pdc_features_cs', label: 'Key Features (comma-separated):', type: 'textarea', placeholder: 'e.g., AI health tracking, 7-day battery, waterproof'}, {id: 'pdc_audience_cs', label: 'Target Audience:', type: 'text', placeholder: 'e.g., Tech-savvy fitness enthusiasts'} ],
          prompt: (inputs) => `Craft a persuasive product description (around 150-200 words) for "${inputs.pdc_name_cs}". Key features: ${inputs.pdc_features_cs}. Target audience: ${inputs.pdc_audience_cs}. Highlight unique selling points and benefits.`
        },
        { id: 'ad-copy-generator-cs', icon: 'campaign', name: 'Ad Copy Generator (Suite)', description: 'Generates short ad copy variations.', type: 'llm_chat', model: MODELS.chatCompletion,
          fields: [ {id: 'acg_product_cs', label: 'Product/Service:', type: 'text', placeholder: 'e.g., "FreshStart Coffee Beans"'}, {id: 'acg_platform_cs', label: 'Target Platform:', type: 'select', options: ['Facebook Ad', 'Google Search Ad', 'Instagram Story Ad']}, {id: 'acg_message_cs', label: 'Key Message/Offer:', type: 'text', placeholder: 'e.g., Organic, ethically sourced, 15% off first order'} ],
          prompt: (inputs) => `Generate 3 short, punchy ad copy variations for ${inputs.acg_platform_cs} promoting "${inputs.acg_product_cs}". Key message: "${inputs.acg_message_cs}". Ensure each variation has a clear call to action.`
        },
        { id: 'story-plot-suggester-cs', icon: 'auto_stories', name: 'Story Plot Suggester (Suite)', description: 'Outlines potential story plots.', type: 'llm_chat', model: MODELS.thinking,
          fields: [ {id: 'sps_genre_cs', label: 'Genre:', type: 'text', placeholder: 'e.g., Sci-Fi Mystery'}, {id: 'sps_character_cs', label: 'Main Character Archetype:', type: 'text', placeholder: 'e.g., Cynical detective'}, {id: 'sps_conflict_cs', label: 'Desired Conflict Type:', type: 'text', placeholder: 'e.g., Man vs. Society'} ],
          prompt: (inputs) => `Suggest 3 distinct story plot outlines for a ${inputs.sps_genre_cs} featuring a ${inputs.sps_character_cs} dealing with a ${inputs.sps_conflict_cs} conflict. Each outline should include a setup, inciting incident, rising action points, climax, and resolution idea.`
        },
        { id: 'code-explainer-simple-cs', icon: 'code_blocks', name: 'Code Explainer (Simple) (Suite)', description: 'Explains simple code snippets.', type: 'llm_chat', model: MODELS.thinking,
          fields: [ {id: 'ces_code_cs', label: 'Paste Code Snippet (max 20 lines):', type: 'textarea', placeholder: 'e.g., function example(a, b) { return a + b; }'}, {id: 'ces_language_cs', label: 'Programming Language:', type: 'text', placeholder: 'e.g., JavaScript'} ],
          prompt: (inputs) => `Explain the following ${inputs.ces_language_cs} code snippet line by line, then provide an overall summary of its purpose and functionality. Keep the explanation clear and concise, suitable for a beginner. Code:\n\`\`\`${inputs.ces_language_cs}\n${inputs.ces_code_cs}\n\`\`\``
        },
        { id: 'recipe-idea-generator-cs', icon: 'restaurant_menu', name: 'Recipe Idea Generator (Suite)', description: 'Suggests recipes based on ingredients.', type: 'llm_chat', model: MODELS.chatCompletion,
          fields: [ {id: 'rig_ingredients_cs', label: 'Main Ingredients (comma-separated):', type: 'text', placeholder: 'e.g., chicken, broccoli, rice'}, {id: 'rig_meal_type_cs', label: 'Meal Type:', type: 'select', options: ['Breakfast', 'Lunch', 'Dinner', 'Snack', 'Dessert']} ],
          prompt: (inputs) => `Generate 3 recipe ideas for ${inputs.rig_meal_type_cs} using these main ingredients: ${inputs.rig_ingredients_cs}. For each idea, provide a name and a brief 1-2 sentence description of the dish.`
        },
        { id: 'persona-creator-cs', icon: 'person_search', name: 'Persona Creator (Suite)', description: 'Develops detailed user personas.', type: 'llm_chat', model: MODELS.chatCompletion,
          fields: [ {id: 'pc_audience_cs', label: 'Describe your target audience/customer:', type: 'textarea', placeholder: 'e.g., Millennial urban dwellers, environmentally conscious, love minimalist design, frequent online shoppers for sustainable products.'} ],
          prompt: (inputs) => `Based on the following target audience description, create a detailed user persona. Include: a fictional name, age, occupation, key characteristics, goals, frustrations/pain points related to relevant products/services, and a short bio. Audience: "${inputs.pc_audience_cs}"`
        },
        { id: 'analogy-generator-cs', icon: 'compare_arrows', name: 'Analogy Generator (Suite)', description: 'Creates simple analogies for complex topics.', type: 'llm_chat', model: MODELS.thinking,
          fields: [ {id: 'ag_concept_cs', label: 'Complex Concept or Topic:', type: 'text', placeholder: 'e.g., Blockchain technology'} ],
          prompt: (inputs) => `Generate 2-3 simple analogies to explain the concept of "${inputs.ag_concept_cs}" to someone unfamiliar with it. Each analogy should be relatable and easy to understand.`
        },
        { id: 'creative-writing-prompt-generator-cs', icon: 'draw', name: 'Creative Writing Prompts (Suite)', description: 'Generates unique writing prompts.', type: 'llm_chat', model: MODELS.chatCompletion,
          fields: [ {id: 'cwpg_genre_cs', label: 'Select Genre (optional):', type: 'select', options: ['Any', 'Sci-Fi', 'Fantasy', 'Mystery', 'Thriller', 'Romance', 'Historical Fiction', 'Contemporary']} ],
          prompt: (inputs) => `Generate 5 unique and inspiring creative writing prompts. ${inputs.cwpg_genre_cs !== 'Any' ? 'The prompts should be suitable for the ' + inputs.cwpg_genre_cs + ' genre.' : 'The prompts can be for any genre.'} Make them open-ended to encourage imagination.`
        },
        { id: 'image-style-idea-cs', icon: 'style', name: 'Image Style Idea (Suite)', description: 'Describes an image in a new artistic style.', type: 'llm_vision_chat', model: MODELS.chatCompletion, visionModel: MODELS.vision,
          fields: [ { id: 'isi_image_cs', label: 'Upload an image:', type: 'file', accept: 'image/*' }, {id: 'isi_style_cs', label: 'Desired New Style:', type: 'text', placeholder: 'e.g., "Van Gogh", "Cyberpunk", "Watercolor"'} ],
          prompt: (inputs) => `Based on the uploaded image (described as: "${inputs.isi_image_cs_desc}"), describe in detail how it might look if re-imagined in a "${inputs.isi_style_cs}" artistic style. Focus on changes to colors, textures, mood, and key elements.`
        },
        { id: 'business-name-generator-cs', icon: 'storefront', name: 'Business Name Generator (Suite)', description: 'Suggests potential business names.', type: 'llm_chat', model: MODELS.chatCompletion,
          fields: [ {id: 'bng_industry_cs', label: 'Industry:', type: 'text', placeholder: 'e.g., Coffee Shop, Tech Startup, Eco-friendly Cleaning'}, {id: 'bng_keywords_cs', label: 'Keywords/Concepts (comma-separated):', type: 'text', placeholder: 'e.g., innovative, green, community, digital'}, {id: 'bng_style_cs', label: 'Desired Name Style:', type: 'select', options: ['Modern', 'Classic', 'Playful', 'Elegant', 'Techy']} ],
          prompt: (inputs) => `Generate 10 potential business names for a business in the "${inputs.bng_industry_cs}" industry. Incorporate keywords/concepts: "${inputs.bng_keywords_cs}". The desired name style is "${inputs.bng_style_cs}".`
        },
        { id: 'domain-name-suggester-cs', icon: 'language', name: 'Domain Name Suggester (Suite)', description: 'Suggests available-sounding domain names.', type: 'llm_chat', model: MODELS.chatCompletion,
          fields: [ {id: 'dns_keywords_cs', label: 'Business Name or Keywords:', type: 'text', placeholder: 'e.g., "QuantumLeap AI" or "eco friendly solutions"'} ],
          prompt: (inputs) => `Suggest 10 creative and available-sounding domain name ideas based on "${inputs.dns_keywords_cs}". Include variations with common TLDs (like .com, .io, .ai, .co). Note: I cannot check actual availability.`
        },
        { id: 'lyrics-idea-generator-cs', icon: 'music_note', name: 'Lyrics Idea Generator (Suite)', description: 'Sparks ideas for song lyrics.', type: 'llm_chat', model: MODELS.chatCompletion,
          fields: [ {id: 'lig_mood_cs', label: 'Song Mood:', type: 'text', placeholder: 'e.g., melancholic, upbeat, reflective'}, {id: 'lig_theme_cs', label: 'Theme/Topic:', type: 'text', placeholder: 'e.g., lost love, new beginnings, city life'}, {id: 'lig_genre_cs', label: 'Genre (optional):', type: 'text', placeholder: 'e.g., Pop, Folk, Indie Rock'} ],
          prompt: (inputs) => `Generate lyrical concepts and a few sample lines for a ${inputs.lig_genre_cs || ''} song with a "${inputs.lig_mood_cs}" mood about "${inputs.lig_theme_cs}". Suggest ideas for a verse and a chorus.`
        },
        { id: 'pros-and-cons-lister-cs', icon: 'balance', name: 'Pros and Cons Lister (Suite)', description: 'Lists pros and cons for a topic.', type: 'llm_chat', model: MODELS.thinking,
          fields: [ {id: 'pac_topic_cs', label: 'Topic, Product, or Decision:', type: 'text', placeholder: 'e.g., "Remote work", "Buying an electric car", "Learning Python"'} ],
          prompt: (inputs) => `Provide a balanced list of pros and cons for "${inputs.pac_topic_cs}". Aim for 3-5 points for each side, with brief explanations.`
        },
        { id: 'meeting-agenda-creator-cs', icon: 'event_note', name: 'Meeting Agenda Creator (Suite)', description: 'Creates structured meeting agendas.', type: 'llm_chat', model: MODELS.chatCompletion,
          fields: [ {id: 'mac_objective_cs', label: 'Meeting Objective:', type: 'text', placeholder: 'e.g., Finalize Q3 marketing strategy'}, {id: 'mac_topics_cs', label: 'Key Topics (comma-separated):', type: 'textarea', placeholder: 'e.g., Budget review, Campaign A analysis, New proposals, Timeline discussion'}, {id: 'mac_duration_cs', label: 'Meeting Duration (e.g., 60 minutes):', type: 'text', placeholder: '60 minutes'} ],
          prompt: (inputs) => `Create a structured meeting agenda for a ${inputs.mac_duration_cs} meeting with the objective: "${inputs.mac_objective_cs}". Key topics to cover: ${inputs.mac_topics_cs}. Allocate approximate times for each topic and include slots for introduction and wrap-up/next steps.`
        },
        { id: 'slogan-generator-cs', icon: 'campaign', name: 'Slogan Generator (Suite)', description: 'Creates catchy slogans.', type: 'llm_chat', model: MODELS.chatCompletion,
          fields: [ {id: 'sg_brand_cs', label: 'Brand/Product Name:', type: 'text', placeholder: 'e.g., "NovaDesk Ergonomics"'}, {id: 'sg_values_cs', label: 'Core Values/Benefits (comma-separated):', type: 'text', placeholder: 'e.g., comfort, productivity, health, modern design'} ],
          prompt: (inputs) => `Generate 5 catchy and memorable slogans for a brand/product named "${inputs.sg_brand_cs}" that emphasizes these core values/benefits: ${inputs.sg_values_cs}.`
        },
        // Additional new tools
        { id: 'elevator-pitch-generator-cs', icon: 'record_voice_over', name: 'Elevator Pitch Generator (Suite)', description: 'Crafts a concise elevator pitch.', type: 'llm_chat', model: MODELS.chatCompletion,
          fields: [ {id: 'epg_product_cs', label: 'Product/Service/Idea:', type: 'text', placeholder: 'e.g., An AI-powered language learning app'}, {id: 'epg_target_cs', label: 'Target Audience/Listener:', type: 'text', placeholder: 'e.g., Potential investors'}, {id: 'epg_usp_cs', label: 'Unique Selling Proposition:', type: 'text', placeholder: 'e.g., Adaptive learning paths based on real-time progress'} ],
          prompt: (inputs) => `Craft a concise and compelling 30-60 second elevator pitch for "${inputs.epg_product_cs}" aimed at ${inputs.epg_target_cs}. Highlight its unique selling proposition: "${inputs.epg_usp_cs}".`
        },
        { id: 'short-story-starter-cs', icon: 'history_edu', name: 'Short Story Starter (Suite)', description: 'Generates an opening paragraph for a short story.', type: 'llm_chat', model: MODELS.chatCompletion,
          fields: [ {id: 'sss_genre_cs', label: 'Genre:', type: 'text', placeholder: 'e.g., Fantasy Adventure'}, {id: 'sss_character_cs', label: 'Main Character Trait:', type: 'text', placeholder: 'e.g., Curious but cautious'}, {id: 'sss_setting_cs', label: 'Setting Hint:', type: 'text', placeholder: 'e.g., A mysterious antique shop'} ],
          prompt: (inputs) => `Write an intriguing opening paragraph (approx. 100-150 words) for a short story in the ${inputs.sss_genre_cs} genre. The main character is ${inputs.sss_character_cs} and the story begins in/around ${inputs.sss_setting_cs}.`
        },
        { id: 'workout-plan-idea-cs', icon: 'fitness_center', name: 'Workout Plan Idea (Suite)', description: 'Suggests a basic workout routine.', type: 'llm_chat', model: MODELS.chatCompletion,
          fields: [ {id: 'wpi_goal_cs', label: 'Fitness Goal:', type: 'select', options: ['Weight Loss', 'Muscle Gain', 'General Fitness', 'Flexibility']}, {id: 'wpi_level_cs', label: 'Experience Level:', type: 'select', options: ['Beginner', 'Intermediate', 'Advanced']}, {id: 'wpi_days_cs', label: 'Days per week (1-5):', type: 'number', placeholder: '3', min: '1', max: '5'} ],
          prompt: (inputs) => `Generate a sample ${inputs.wpi_days_cs}-day workout plan idea for a ${inputs.wpi_level_cs} individual aiming for ${inputs.wpi_goal_cs}. For each day, suggest 3-4 exercises (e.g., "Day 1: Squats, Push-ups, Plank"). This is for informational purposes only; consult a professional before starting any new workout routine.`
        },
        { id: 'debate-topic-generator-cs', icon: 'forum', name: 'Debate Topic Generator (Suite)', description: 'Generates interesting debate topics.', type: 'llm_chat', model: MODELS.chatCompletion,
          fields: [ {id: 'dtg_category_cs', label: 'Category (optional):', type: 'text', placeholder: 'e.g., Ethics, Technology, Education'} ],
          prompt: (inputs) => `Generate 5 interesting and debatable topics. ${inputs.dtg_category_cs ? 'Focus on the category: ' + inputs.dtg_category_cs + '.' : ''} Each topic should be phrased as a clear proposition (e.g., "Resolved: AI will create more jobs than it displaces.").`
        },
        { id: 'character-name-generator-cs', icon: 'badge', name: 'Character Name Generator (Suite)', description: 'Suggests names for fictional characters.', type: 'llm_chat', model: MODELS.chatCompletion,
          fields: [ {id: 'cng_genre_cs', label: 'Story Genre (optional):', type: 'text', placeholder: 'e.g., Fantasy, Sci-Fi, Modern'}, {id: 'cng_gender_cs', label: 'Gender (optional):', type: 'select', options: ['Any', 'Male', 'Female', 'Non-binary']} ],
          prompt: (inputs) => `Generate 10 fictional character names. ${inputs.cng_genre_cs ? 'Suitable for a ' + inputs.cng_genre_cs + ' setting. ' : ''} ${inputs.cng_gender_cs !== 'Any' ? 'Consider names for a ' + inputs.cng_gender_cs + ' character. ' : ''}Provide a mix of common and unique sounding names.`
        },
    ];


    // --- AI Creator Suite Logic ---
    function populateAiCreatorSuiteNav() {
        const navContainer = document.getElementById('aiCreatorSuiteNavLinks');
        if (!navContainer) return;
        navContainer.innerHTML = '';
        const ul = document.createElement('ul');
        aiCreatorToolsDefinitions.forEach(tool => {
            const li = document.createElement('li');
            // Use Material Symbols if available, otherwise Font Awesome
            const iconHtml = tool.icon.startsWith('fa') ? `<i class="${tool.icon}"></i>` : `<span class="material-symbols-outlined">${tool.icon}</span>`;
            li.innerHTML = `<a href="#" class="ai-tool-nav-link" data-tool-id="${tool.id}">${iconHtml}<span>${tool.name}</span></a>`;
            ul.appendChild(li);
        });
        navContainer.appendChild(ul);

        // Add event listeners to newly created nav links
        document.querySelectorAll('.ai-tool-nav-link').forEach(link => {
            link.addEventListener('click', function(e) {
                e.preventDefault();
                document.querySelectorAll('.sidebar-nav a').forEach(l => l.classList.remove('active'));
                this.classList.add('active');
                activateAiCreatorTool(this.dataset.toolId);
            });
        });
    }

    function activateAiCreatorTool(toolId) {
        const tool = aiCreatorToolsDefinitions.find(t => t.id === toolId);
        if (!tool) { console.error("AI Creator Tool definition not found:", toolId); return; }

        if (mainContentHeader && mainContentHeader.querySelector('h2')) mainContentHeader.querySelector('h2').textContent = tool.name;
        if (mainContentHeader && mainContentHeader.querySelector('p')) mainContentHeader.querySelector('p').textContent = tool.description;
        if (topbarTitle) topbarTitle.textContent = tool.name;


        if (weConnectToolGrid) weConnectToolGrid.style.display = 'none';
        if (walletCard) walletCard.style.display = 'none';
        if (aiToolContentContainer) aiToolContentContainer.style.display = 'block';
        if (currentAiToolWrapper) currentAiToolWrapper.innerHTML = ''; // Clear previous

        if (apiKeyNotice) { // Show API key notice only if a placeholder is detected
            apiKeyNotice.classList.toggle('hidden', TOGETHER_API_KEY !== "YOUR_TOGETHER_API_KEY_PLACEHOLDER" && DEEPGRAM_API_KEY !== "YOUR_DEEPGRAM_API_KEY_PLACEHOLDER");
        }


        if (tool.type === 'placeholder_suite') {
            currentAiToolWrapper.innerHTML = `
                <h3 class="text-xl font-semibold mb-4 text-gray-800 dark:text-gray-200">${tool.name}</h3>
                <p class="text-gray-600 dark:text-gray-400">${tool.description}</p>
                <p class="mt-2 text-sm text-gray-500 dark:text-gray-500"><em>${tool.details || 'Full functionality for this tool is under development or requires specific client-side logic.'}</em></p>
                <button onclick="showAiCreatorSuiteDashboard()" class="mt-6 bg-gray-200 hover:bg-gray-300 text-gray-700 font-medium py-2 px-4 rounded-lg dark:bg-gray-700 dark:text-gray-300 dark:hover:bg-gray-600">Back to AI Suite</button>
            `;
            return;
        }


        const toolTitle = document.createElement('h3');
        toolTitle.classList.add('text-xl', 'font-semibold', 'mb-4', 'text-gray-800', 'dark:text-gray-200');
        toolTitle.textContent = tool.name;
        currentAiToolWrapper.appendChild(toolTitle);

        if (tool.fields) {
            tool.fields.forEach(field => {
                const label = document.createElement('label');
                label.htmlFor = field.id;
                label.textContent = field.label;
                label.classList.add('block', 'mb-2', 'text-sm', 'font-medium', 'text-gray-700', 'dark:text-gray-300');
                currentAiToolWrapper.appendChild(label);

                if (field.type === 'textarea') {
                    const textarea = document.createElement('textarea');
                    textarea.id = field.id;
                    textarea.placeholder = field.placeholder || '';
                    textarea.classList.add('bg-gray-50', 'border', 'border-gray-300', 'text-gray-900', 'text-sm', 'rounded-lg', 'focus:ring-blue-500', 'focus:border-blue-500', 'block', 'w-full', 'p-2.5', 'dark:bg-gray-700', 'dark:border-gray-600', 'dark:placeholder-gray-400', 'dark:text-white', 'min-h-[80px]');
                    currentAiToolWrapper.appendChild(textarea);
                } else if (field.type === 'select') {
                    const select = document.createElement('select');
                    select.id = field.id;
                    select.classList.add('bg-gray-50', 'border', 'border-gray-300', 'text-gray-900', 'text-sm', 'rounded-lg', 'focus:ring-blue-500', 'focus:border-blue-500', 'block', 'w-full', 'p-2.5', 'dark:bg-gray-700', 'dark:border-gray-600', 'dark:placeholder-gray-400', 'dark:text-white');
                    field.options.forEach(opt => {
                        const option = document.createElement('option');
                        option.value = opt;
                        option.textContent = opt;
                        select.appendChild(option);
                    });
                    currentAiToolWrapper.appendChild(select);
                } else if (field.type === 'file') {
                    const input = document.createElement('input');
                    input.type = 'file';
                    input.id = field.id;
                    input.accept = field.accept || '';
                    input.classList.add('block', 'w-full', 'text-sm', 'text-gray-900', 'border', 'border-gray-300', 'rounded-lg', 'cursor-pointer', 'bg-gray-50', 'dark:text-gray-400', 'focus:outline-none', 'dark:bg-gray-700', 'dark:border-gray-600', 'dark:placeholder-gray-400', 'p-2');
                    currentAiToolWrapper.appendChild(input);
                    if (field.accept.includes('image')) {
                        const preview = document.createElement('img');
                        preview.id = field.id + '_preview';
                        preview.alt = "Image preview";
                        preview.classList.add('hidden', 'max-w-[200px]', 'mt-2', 'mb-2', 'rounded-md', 'border', 'dark:border-gray-600');
                        currentAiToolWrapper.appendChild(preview);
                        input.addEventListener('change', () => imagePreview(field.id, field.id + '_preview'));
                    }
                } else { // text, number
                    const input = document.createElement('input');
                    input.type = field.type;
                    input.id = field.id;
                    input.placeholder = field.placeholder || '';
                    if(field.min) input.min = field.min;
                    if(field.max) input.max = field.max;
                    input.classList.add('bg-gray-50', 'border', 'border-gray-300', 'text-gray-900', 'text-sm', 'rounded-lg', 'focus:ring-blue-500', 'focus:border-blue-500', 'block', 'w-full', 'p-2.5', 'dark:bg-gray-700', 'dark:border-gray-600', 'dark:placeholder-gray-400', 'dark:text-white');
                    currentAiToolWrapper.appendChild(input);
                }
            });
        }

        const buttonGroup = document.createElement('div');
        buttonGroup.classList.add('mt-6', 'flex', 'gap-4');

        const generateBtn = document.createElement('button');
        generateBtn.textContent = tool.type === 'llm_image' ? 'Generate Image' : 'Generate';
        generateBtn.classList.add('text-white', 'bg-blue-600', 'hover:bg-blue-700', 'focus:ring-4', 'focus:ring-blue-300', 'font-medium', 'rounded-lg', 'text-sm', 'px-5', 'py-2.5', 'text-center', 'dark:bg-blue-500', 'dark:hover:bg-blue-600');
        generateBtn.addEventListener('click', () => handleAiCreatorToolGeneration(tool));
        buttonGroup.appendChild(generateBtn);

        const backBtn = document.createElement('button');
        backBtn.textContent = 'Back to AI Suite';
        backBtn.classList.add('text-gray-700', 'bg-gray-200', 'hover:bg-gray-300', 'font-medium', 'rounded-lg', 'text-sm', 'px-5', 'py-2.5', 'text-center', 'dark:bg-gray-600', 'dark:text-gray-300', 'dark:hover:bg-gray-500');
        backBtn.addEventListener('click', showAiCreatorSuiteDashboard);
        buttonGroup.appendChild(backBtn);
        currentAiToolWrapper.appendChild(buttonGroup);

        const spinner = document.createElement('div');
        spinner.classList.add('spinner'); // Tailwind styles this directly
        spinner.id = tool.id + '_spinner_cs';
        currentAiToolWrapper.appendChild(spinner);

        const outputDiv = document.createElement('div');
        outputDiv.classList.add('output', 'mt-4', 'p-4', 'rounded-md'); // Tailwind styles
        outputDiv.id = tool.id + '_output_cs';
        currentAiToolWrapper.appendChild(outputDiv);

        if (window.innerWidth <= 767 && sidebar && sidebar.classList.contains('open')) {
            sidebar.classList.remove('open');
        }
         window.scrollTo({ top: 0, behavior: 'smooth' });
    }

    function showAiCreatorSuiteDashboard() {
        if (mainContentHeader && mainContentHeader.querySelector('h2')) mainContentHeader.querySelector('h2').textContent = "AI Creator Suite";
        if (mainContentHeader && mainContentHeader.querySelector('p')) mainContentHeader.querySelector('p').textContent = "Explore various AI-powered tools.";
        if (topbarTitle) topbarTitle.textContent = "AI Creator Suite";

        if (weConnectToolGrid) weConnectToolGrid.style.display = 'none';
        if (walletCard) walletCard.style.display = 'none';
        if (aiToolContentContainer) aiToolContentContainer.style.display = 'block';
        if (currentAiToolWrapper) { // Instead of hiding, populate with AI tool cards
            currentAiToolWrapper.innerHTML = ''; // Clear any active tool
            const gridForAiTools = document.createElement('div');
            gridForAiTools.classList.add('grid', 'grid-cols-1', 'md:grid-cols-2', 'gap-4'); // Using Tailwind grid

            aiCreatorToolsDefinitions.forEach(tool => {
                const card = document.createElement('div');
                // Using WeConnect card style for AI tools too for consistency in this view
                card.className = 'weconnect-tool-card p-4 rounded-lg shadow-md cursor-pointer bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 hover:shadow-lg';
                card.dataset.toolId = tool.id;

                const iconHtml = tool.icon.startsWith('fa') ? `<i class="${tool.icon} text-blue-600 dark:text-cyan-400 text-xl mr-3"></i>` : `<span class="material-symbols-outlined text-blue-600 dark:text-cyan-400 text-xl mr-3">${tool.icon}</span>`;

                card.innerHTML = `
                    <div class="flex items-center mb-2">
                        ${iconHtml}
                        <h3 class="text-md font-semibold text-gray-800 dark:text-gray-200">${tool.name}</h3>
                    </div>
                    <p class="text-xs text-gray-600 dark:text-gray-400 mb-3 h-12 overflow-hidden">${tool.description}</p>
                    <button class="text-xs bg-blue-500 hover:bg-blue-600 text-white font-semibold py-1 px-3 rounded dark:bg-cyan-500 dark:hover:bg-cyan-600 dark:text-black">Open Tool</button>
                `;
                card.addEventListener('click', () => activateAiCreatorTool(tool.id));
                gridForAiTools.appendChild(card);
            });
            currentAiToolWrapper.appendChild(gridForAiTools);
        }
        document.querySelectorAll('.sidebar-nav a').forEach(l => l.classList.remove('active'));
        const suiteLink = document.querySelector('.sidebar-nav a[data-section="all-ai-creator-tools"]');
        if (suiteLink) suiteLink.classList.add('active');
         window.scrollTo({ top: 0, behavior: 'smooth' });
    }
    
    async function handleAiCreatorToolGeneration(tool) {
        if (TOGETHER_API_KEY === "YOUR_TOGETHER_API_KEY_PLACEHOLDER" && (tool.type.startsWith('llm_') || tool.type.startsWith('deepgram_'))) {
            alert("Please set your API Key in the script to use this tool.");
            return;
        }
         if (DEEPGRAM_API_KEY === "YOUR_DEEPGRAM_API_KEY_PLACEHOLDER" && tool.type.startsWith('deepgram_')) {
            alert("Please set your Deepgram API Key in the script for this tool.");
            return;
        }


        const outputElement = document.getElementById(tool.id + '_output_cs');
        const spinnerElement = document.getElementById(tool.id + '_spinner_cs');
        if (!outputElement || !spinnerElement) { console.error("Output/Spinner not found for AI tool:", tool.id); return; }

        outputElement.innerHTML = ''; // Clear previous output
        spinnerElement.style.display = 'block'; // Show spinner

        const inputs = {};
        let imageBase64ForVision = null;

        if (tool.fields) {
            for (const field of tool.fields) {
                const el = document.getElementById(field.id);
                if (!el) continue;
                if (field.type === 'file' && el.files && el.files[0]) {
                     if (tool.type === 'llm_vision' || tool.type === 'llm_vision_chat' || tool.type === 'deepgram_stt') {
                        imageBase64ForVision = await fileToBase64(el.files[0]); // Also used for audio file for STT
                        if (tool.type === 'llm_vision_chat') {
                             const visionDescPrompt = "Describe this image briefly for context in a subsequent task.";
                             const imageDesc = await callTogetherVision(imageBase64ForVision, visionDescPrompt, tool.visionModel, outputElement, spinnerElement, true);
                             if (!imageDesc) {
                                outputElement.innerHTML += '<p class="text-red-500">Could not get image description for context. Aborting.</p>';
                                spinnerElement.style.display = 'none'; return;
                             }
                             inputs[field.id + '_desc'] = imageDesc;
                        }
                    }
                } else {
                    inputs[field.id] = el.value;
                }
            }
        }

        try {
            let resultTextOrUrl;
            const currentOutputDiv = document.getElementById(tool.id + '_output_cs'); // Re-fetch for safety
            if (tool.type === 'llm_chat' || tool.type === 'llm_thinking') {
                const prompt = tool.prompt(inputs);
                resultTextOrUrl = await callLlama3(prompt, tool.id + '_spinner_cs', tool.id + '_output_cs', tool.model); // Pass model
            } else if (tool.type === 'llm_vision_chat') {
                const prompt = tool.prompt(inputs); // inputs already contains image_desc
                resultTextOrUrl = await callLlama3(prompt, tool.id + '_spinner_cs', tool.id + '_output_cs', tool.model);
            } else if (tool.type === 'llm_image') {
                resultTextOrUrl = await callFluxImageGeneration(inputs[tool.fields[0].id], tool.id + '_spinner_cs', tool.id + '_output_cs');
            } else if (tool.type === 'llm_vision') {
                if (!imageBase64ForVision) throw new Error("Image required for vision tool.");
                const visionResult = await callLlamaVision(imageBase64ForVision, "Describe this image comprehensively.", tool.id + '_spinner_cs', tool.id + '_output_cs', tool.model); // Pass model
                resultTextOrUrl = tool.promptFromVision ? tool.promptFromVision(visionResult) : visionResult;
            } else if (tool.type === 'deepgram_tts') {
                await callDeepgramTTS(inputs[tool.fields[0].id], tool.id + '_spinner_cs', tool.id + '_output_cs');
                resultTextOrUrl = null; // TTS handles its own output display
            } else if (tool.type === 'deepgram_stt') {
                if (!imageBase64ForVision) throw new Error("Audio file required for STT tool."); // Reusing imageBase64ForVision for audio file data
                 const audioFileInput = document.getElementById(tool.fields[0].id);
                if (audioFileInput.files.length === 0) throw new Error("Audio file required.");
                resultTextOrUrl = await callDeepgramSTT(audioFileInput.files[0], tool.id + '_spinner_cs', tool.id + '_output_cs');
            }


            if (resultTextOrUrl && typeof resultTextOrUrl === 'string' && currentOutputDiv && tool.type !== 'llm_image' && tool.type !== 'deepgram_tts') {
                 // If there's a preview image, append text after it. Otherwise, set textContent.
                const previewImageInOutput = currentOutputDiv.querySelector('img.preview-image');
                if (previewImageInOutput) {
                    const textDiv = document.createElement('div');
                    textDiv.classList.add('mt-2', 'whitespace-pre-wrap');
                    textDiv.textContent = resultTextOrUrl;
                    currentOutputDiv.appendChild(textDiv);
                } else {
                    currentOutputDiv.textContent = resultTextOrUrl;
                }
            }
             // Image generation and TTS handle their own DOM manipulation in their functions.

        } catch (error) {
            console.error("Error handling AI tool generation:", error);
            if (currentOutputDiv) currentOutputDiv.innerHTML = `<p class="text-red-500 dark:text-red-400">Error: ${error.message}</p>`;
        } finally {
            const currentSpinner = document.getElementById(tool.id + '_spinner_cs');
            if(currentSpinner) currentSpinner.style.display = 'none';
        }
    }

    // --- API Call Functions (Ensure models are passed) ---
    async function callLlama3(promptContent, spinnerId, outputId, modelToUse = MODELS.chatCompletion) { // modelToUse defaults to chatCompletion
        if (!TOGETHER_API_KEY || TOGETHER_API_KEY === "YOUR_TOGETHER_API_KEY_PLACEHOLDER") { /* ... as before ... */ }
        showSpinner(spinnerId);
        displayOutput(outputId, '');
        try {
            const response = await fetch("https://api.together.xyz/v1/chat/completions", {
                method: "POST", headers: { "Authorization": `Bearer ${TOGETHER_API_KEY}`, "Content-Type": "application/json" },
                body: JSON.stringify({ model: modelToUse, messages: [{ role: "user", content: promptContent }], max_tokens: 1024, temperature: 0.7 })
            });
            if (!response.ok) { const errData = await response.json(); throw new Error(`API Error (${response.status}): ${errData.error?.message || 'Unknown error'}`); }
            const data = await response.json();
            const resultText = data.choices?.[0]?.message?.content?.trim() || "No content received.";
            displayOutput(outputId, resultText);
            return resultText; // Return for potential further processing
        } catch (error) { console.error(`${modelToUse} API call failed:`, error); displayError(outputId, error); return null; }
        finally { hideSpinner(spinnerId); }
    }

    async function callLlamaVision(imageBase64, promptContent, spinnerId, outputId, modelToUse = MODELS.vision, isIntermediate = false) {
        if (!TOGETHER_API_KEY || TOGETHER_API_KEY === "YOUR_TOGETHER_API_KEY_PLACEHOLDER") { /* ... */ }
        showSpinner(spinnerId);
        const outputElement = currentAiToolWrapper.querySelector(`#${outputId}`);
        
        if (!isIntermediate && outputElement) {
             outputElement.innerHTML = `<img src="${imageBase64}" alt="Preview" class="preview-image max-w-[200px] my-2 rounded-md border dark:border-gray-600">`;
        } else if (isIntermediate && outputElement.querySelector('.preview-image')) {
            // Keep existing preview for intermediate vision call if one exists
        }


        try {
            const response = await fetch("https://api.together.xyz/v1/chat/completions", {
                method: "POST", headers: { "Authorization": `Bearer ${TOGETHER_API_KEY}`, "Content-Type": "application/json" },
                body: JSON.stringify({
                    model: modelToUse,
                    messages: [{ role: "user", content: [{ type: "image_url", image_url: { url: imageBase64 } }, { type: "text", text: promptContent }] }],
                    max_tokens: 512
                })
            });
            if (!response.ok) { const errData = await response.json(); throw new Error(`API Error (${response.status}): ${errData.error?.message || 'Unknown error'}`); }
            const data = await response.json();
            const resultText = data.choices?.[0]?.message?.content?.trim() || (isIntermediate ? null : "No description received.");
            
            if (!isIntermediate && outputElement) {
                const textNode = document.createElement('div');
                textNode.classList.add('mt-2', 'whitespace-pre-wrap');
                textNode.textContent = resultText;
                outputElement.appendChild(textNode);
            }
            return resultText;
        } catch (error) { console.error("Llama Vision API call failed:", error); if (!isIntermediate) displayError(outputId, error); return null;}
        finally { if (!isIntermediate) hideSpinner(spinnerId); }
    }

    async function callFluxImageGeneration(prompt, spinnerId, outputId) {
        if (!TOGETHER_API_KEY || TOGETHER_API_KEY === "YOUR_TOGETHER_API_KEY_PLACEHOLDER") { /* ... */ }
        showSpinner(spinnerId);
        const outputElement = currentAiToolWrapper.querySelector(`#${outputId}`);
        if(outputElement) outputElement.innerHTML = '';

        try {
            const response = await fetch("https://api.together.xyz/v1/images/generations", {
                method: "POST", headers: { "Authorization": `Bearer ${TOGETHER_API_KEY}`, "Content-Type": "application/json" },
                body: JSON.stringify({ model: MODELS.imageGen, prompt: prompt, width: 512, height: 512, steps: 25, n: 1, response_format: "b64_json" }) // Adjusted steps
            });
            if (!response.ok) { const errData = await response.json(); throw new Error(`API Error (${response.status}): ${errData.error?.message || 'Unknown error'}`); }
            const data = await response.json();
            if (data.data?.[0]?.b64_json && outputElement) {
                const imgElement = document.createElement('img');
                imgElement.src = `data:image/png;base64,${data.data[0].b64_json}`;
                imgElement.alt = prompt;
                imgElement.classList.add('mx-auto', 'my-2', 'rounded-md', 'border', 'border-gray-300', 'dark:border-gray-600');
                outputElement.appendChild(imgElement);
                return imgElement.src; // Return for potential chaining
            } else { displayOutput(outputId, "No image data received."); return null; }
        } catch (error) { console.error("Image Generation API call failed:", error); displayError(outputId, error); return null; }
        finally { hideSpinner(spinnerId); }
    }
    
    // Deepgram functions remain the same as in previous response.

    // --- Initial Load & Event Listeners ---
    document.addEventListener('DOMContentLoaded', () => {
        console.log('WeConnect App Initializing with AI Creator Suite...');
        initTheme();
        setInitialSidebarState();
        populateAiCreatorSuiteNav();
        displayWeConnectPlatformTools(weConnectPlatformTools); // Display platform tools on dashboard

        if (pageLoadingElement) pageLoadingElement.classList.remove('hidden'); // Show initially

        document.querySelectorAll('.main-nav-link').forEach(link => {
            link.addEventListener('click', function(e) {
                e.preventDefault();
                document.querySelectorAll('.main-nav-link').forEach(l => l.classList.remove('active'));
                this.classList.add('active');
                const sectionId = this.dataset.section;
                const topbarTitleEl = document.getElementById('topbarTitle');

                if (sectionId === 'dashboard') {
                    if(topbarTitleEl) topbarTitleEl.textContent = "WeConnect Dashboard";
                    showDashboardView();
                } else if (sectionId === 'all-ai-creator-tools') {
                    if(topbarTitleEl) topbarTitleEl.textContent = "AI Creator Suite";
                    showAiCreatorSuiteDashboard();
                } else if (sectionId) { // Handle other main sections
                    if(topbarTitleEl) topbarTitleEl.textContent = this.querySelector('span')?.textContent || 'WeConnect';
                    showGenericSectionView(sectionId, this.querySelector('span')?.textContent);
                }
                if (window.innerWidth <= 767 && sidebar && sidebar.classList.contains('open')) {
                    sidebar.classList.remove('open');
                }
            });
        });
        
        // Ensure Dashboard is active by default
        const dashboardLink = document.querySelector('.main-nav-link[data-section="dashboard"]');
        if (dashboardLink) dashboardLink.classList.add('active');
        showDashboardView(); // Show dashboard on initial load

        // Hide loader after a slight delay or once Firebase auth state is known
        auth.onAuthStateChanged(user => {
           setTimeout(() => { if(pageLoadingElement) pageLoadingElement.classList.add('hidden'); }, 500);
        });
    });

    function showDashboardView() {
        if (mainContentHeader && mainContentHeader.querySelector('h2')) mainContentHeader.querySelector('h2').textContent = "Dashboard Tools";
        if (mainContentHeader && mainContentHeader.querySelector('p')) mainContentHeader.querySelector('p').textContent = "Explore our WeConnect platform tools.";
        if (topbarTitle) topbarTitle.textContent = "WeConnect Dashboard";


        if (aiToolContentContainer) aiToolContentContainer.style.display = 'none';
        if (apiKeyNotice) apiKeyNotice.style.display = 'none';
        if (weConnectToolGrid) weConnectToolGrid.style.display = 'grid';
        if (walletCard) walletCard.style.display = 'block';
        displayWeConnectPlatformTools(weConnectPlatformTools);
         window.scrollTo({ top: 0, behavior: 'smooth' });
    }

    function showGenericSectionView(sectionId, sectionTitle) {
        if (mainContentHeader && mainContentHeader.querySelector('h2')) mainContentHeader.querySelector('h2').textContent = sectionTitle || "Section";
        if (mainContentHeader && mainContentHeader.querySelector('p')) mainContentHeader.querySelector('p').textContent = `Content for ${sectionTitle || sectionId} goes here.`;
        if (topbarTitle) topbarTitle.textContent = sectionTitle || "WeConnect";


        if (aiToolContentContainer) aiToolContentContainer.style.display = 'none';
        if (apiKeyNotice) apiKeyNotice.style.display = 'none';
        if (weConnectToolGrid) weConnectToolGrid.innerHTML = `<p class="text-center col-span-full p-4 bg-white dark:bg-gray-800 rounded-md shadow">Displaying content for: ${sectionTitle || sectionId}</p>`;
        if (walletCard) walletCard.style.display = 'block'; // Keep wallet card visible on generic sections too for now
         window.scrollTo({ top: 0, behavior: 'smooth' });
    }
</script>
</body>
</html><script>
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('/service-worker.js')
        .then(registration => {
          console.log('Service Worker registered with scope:', registration.scope);
        })
        .catch(error => {
          console.error('Service worker registration failed:', error);
        });
    }
  <\/script>
